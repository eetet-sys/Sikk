<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ì‹ê²°(é£Ÿçµ) - ë§ˆìŠ¤í„° ì •ë°€ ìš´ëª… ì²˜ë°©</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;500;700&display=swap');
        :root { --paper: #f4f1ea; --ink: #2c2c2c; --wood: #5d7a66; --fire: #a64e4e; --earth: #c4a46d; --metal: #8a8a8a; --water: #4e657a; }
        body { font-family: 'Noto Serif KR', serif; background-color: #e0ddd5; margin: 0; padding: 20px; color: var(--ink); line-height: 1.7; word-break: keep-all; }
        .app-container { max-width: 450px; margin: auto; background: var(--paper); border: 1px solid #d1cdbf; box-shadow: 0 12px 50px rgba(0,0,0,0.12); }
        .header { padding: 40px 20px; text-align: center; border-bottom: 1px double #d1cdbf; }
        .header h1 { font-weight: 700; letter-spacing: 12px; margin: 0; font-size: 1.8rem; }
        .content { padding: 30px 25px; }
        .section-title { font-size: 0.95rem; font-weight: 700; margin: 25px 0 12px; border-left: 3px solid var(--ink); padding-left: 12px; }
        input, select { width: 100%; border: none; border-bottom: 1px solid #bbb; background: transparent; padding: 12px 8px; margin-bottom: 15px; font-family: inherit; font-size: 1rem; outline: none; box-sizing: border-box; }
        button { width: 100%; padding: 18px; border: 1px solid var(--ink); background: var(--ink); color: white; cursor: pointer; font-family: inherit; font-weight: 500; display: flex; justify-content: center; align-items: center; letter-spacing: 2px; transition: 0.3s; }
        button:active { transform: scale(0.98); }
        .food-tag { display: inline-flex; align-items: center; justify-content: center; padding: 8px 16px; margin: 5px; background: #fff; border: 1px solid #d1cdbf; cursor: pointer; border-radius: 30px; font-size: 0.85rem; font-weight: 500; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: var(--paper); width: 85%; max-width: 380px; padding: 35px; border-radius: 2px; max-height: 85vh; overflow-y: auto; text-align: center; }
        .q-group { text-align: left; margin-bottom: 20px; }
        .q-group b { display: block; margin-bottom: 10px; font-size: 0.95rem; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .q-group label { display: flex; align-items: center; margin-bottom: 8px; font-size: 0.85rem; cursor: pointer; }
        .q-group input { width: auto; margin: 0 10px 0 0; accent-color: var(--ink); flex-shrink: 0; }
        #journalCapture { display: none; width: 400px; padding: 50px; background: var(--paper); border: 2px solid var(--ink); color: var(--ink); }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h1>é£Ÿ çµ</h1>
        <p style="font-size:0.8rem; color:#777;">ì‚¬ì£¼Â·ì²´ì§ˆÂ·ì»¨ë””ì…˜ì˜ ì™„ë²½í•œ ì¡°í™”</p>
    </div>

    <div class="content">
        <input type="text" id="userNameInput" placeholder="ì„±í•¨ ë˜ëŠ” í˜¸">
        <div class="section-title">ì¶œìƒ ì •ë³´ ë° ë„ì‹œ</div>
        <input type="date" id="birthDate" value="1995-01-01">
        <select id="birthCity">
            <option value="127.0">ì„œìš¸/ê²½ê¸° (í‘œì¤€)</option>
            <option value="129.0">ë¶€ì‚°/ìš¸ì‚° (+8ë¶„)</option>
            <option value="126.5">ì¸ì²œ/ì œì£¼ (-2ë¶„)</option>
            <option value="128.6">ëŒ€êµ¬/ê²½ë¶ (+6ë¶„)</option>
            <option value="127.4">ëŒ€ì „/ì¶©ì²­ (+2ë¶„)</option>
        </select>
        <select id="birthTime">
            <option value="0">å­ì‹œ (23:30 ~ 01:29)</option><option value="2">ä¸‘ì‹œ (01:30 ~ 03:29)</option>
            <option value="4">å¯…ì‹œ (03:30 ~ 05:29)</option><option value="6">å¯ì‹œ (05:30 ~ 07:29)</option>
            <option value="8">è¾°ì‹œ (07:30 ~ 09:29)</option><option value="10">å·³ì‹œ (09:30 ~ 11:29)</option>
            <option value="12">åˆì‹œ (11:30 ~ 13:29)</option><option value="14">æœªì‹œ (13:30 ~ 15:29)</option>
            <option value="16">ç”³ì‹œ (15:30 ~ 17:29)</option><option value="18">é…‰ì‹œ (17:30 ~ 19:29)</option>
            <option value="20">æˆŒì‹œ (19:30 ~ 21:29)</option><option value="22">äº¥ì‹œ (21:30 ~ 23:29)</option>
        </select>

        <button onclick="openModal()">ì •ë°€ ë¶„ì„ ë° ì²˜ë°© ì‹œì‘</button>

        <div id="resultArea" style="display:none; margin-top:40px; border-top:2px solid var(--ink); padding-top:30px;">
            <div id="dailyInfo" style="text-align:center; font-size:0.85rem; color:#888; margin-bottom:15px;"></div>
            
            <div class="section-title">ë©”ë‰´ ê¶í•© ì§ì ‘ ì§„ë‹¨</div>
            <div style="display: flex; gap: 8px;">
                <input type="text" id="userFoodInput" placeholder="ë©”ë‰´ ì…ë ¥ (ì˜ˆ: ë§ˆë¼íƒ•)" style="margin-bottom:0;">
                <button onclick="checkFoodHarmony()" style="width: 85px; padding: 12px; margin-top:0; font-size:0.9rem;">ì§„ë‹¨</button>
            </div>
            <div id="harmonyResult" style="margin: 15px 0; font-size: 0.85rem; font-weight: 700; text-align:center;"></div>

            <div style="height:260px; margin:20px 0;"><canvas id="energyChart"></canvas></div>
            
            <div id="foodBox" style="background: rgba(0,0,0,0.02); padding: 25px; border-radius: 2px; margin: 25px 0; border: 1px solid rgba(0,0,0,0.05);">
                <div id="resTitle" style="font-size:1.3rem; font-weight:700; color:var(--fire); margin-bottom:12px;"></div>
                <div id="resDesc" style="font-size:0.9rem; color:#666; margin-bottom:18px;"></div>
                <div id="resFoodList"></div>
            </div>
            
            <button style="background:#fff; color:var(--ink);" onclick="searchMap()">ğŸ“ ì£¼ë³€ ë§›ì§‘ ì¶”ì²œ</button>
            <button onclick="saveJournal()" style="background:#8e735b; border:none; margin-top:10px;">ğŸ“œ ì˜¤ëŠ˜ì˜ ì‹ê²° ì¼ê¸° ì €ì¥</button>
        </div>
    </div>
</div>

<div id="diagModal" class="modal">
    <div class="modal-content">
        <h3>ì‹¤ì‹œê°„ ì»¨ë””ì…˜ & ì²´ì§ˆ ì§„ë‹¨</h3>
        <div class="q-group">
            <b>1. ì²´ê²©ê³¼ ì²´ì¤‘ ë³€í™”ëŠ”?</b>
            <label><input type="radio" name="qBody" value="íƒœìŒì¸"> ì²´êµ¬ê°€ í¬ê³  ì‚´ì´ ì‰½ê²Œ ì°ŒëŠ” í¸</label>
            <label><input type="radio" name="qBody" value="ì†ŒìŒì¸"> ì²´êµ¬ê°€ ì‘ê³  ì‚´ì´ ì˜ ì•ˆ ì°ŒëŠ” í¸</label>
            <label><input type="radio" name="qBody" value="ì†Œì–‘ì¸"> ìƒì²´ ë°œë‹¬, í•˜ì²´ê°€ ê°€ë²¼ìš´ í¸</label>
        </div>
        <div class="q-group">
            <b>2. í˜„ì¬ì˜ ìŠ¤íŠ¸ë ˆìŠ¤ ìƒíƒœëŠ”?</b>
            <label><input type="radio" name="qStress" value="high"> ìŠ¤íŠ¸ë ˆìŠ¤ ë†’ìŒ (ë‹µë‹µí•¨)</label>
            <label><input type="radio" name="qStress" value="low"> í‰ì˜¨í•¨ (ì•ˆì •ë¨)</label>
        </div>
        <div class="q-group">
            <b>3. ì–´ì œ ìˆ˜ë©´ì˜ ì§ˆì€?</b>
            <label><input type="radio" name="qSleep" value="bad"> ìˆ˜ë©´ ë¶€ì¡± (í”¼ê³¤í•¨)</label>
            <label><input type="radio" name="qSleep" value="good"> ì¶©ë¶„í•œ íœ´ì‹ (ê°œìš´í•¨)</label>
        </div>
        <button onclick="finishDiag()">ë¶„ì„ ì™„ë£Œ</button>
    </div>
</div>

<script>
    let chart=null, baseCounts={}, currentLack='';
    const foodFiveElements = { 'ì¹˜í‚¨':'ëª©', 'ìƒëŸ¬ë“œ':'ëª©', 'ë§ˆë¼íƒ•':'í™”', 'í”¼ì':'í™”', 'ì‚¼ê²¹ì‚´':'ìˆ˜', 'íšŒ':'ìˆ˜', 'ë² ì´ê¸€':'í† ', 'ëˆì¹´ì¸ ':'ê¸ˆ' };
    const foodEffects = { 
        'ê·¸ë¦­ ìš”ê±°íŠ¸':'ê°„ í•´ë…ê³¼ ìƒê¸°ë¥¼ ê¹¨ì›ë‹ˆë‹¤.', 
        'ë§ˆë¼íƒ•':'ì‹¬ì¥ ìˆœí™˜ì„ ë•ê³  ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ í’‰ë‹ˆë‹¤.', 
        'ë“¤ê¸°ë¦„ ë§‰êµ­ìˆ˜':'ìœ„ì¥ì˜ ì—´ì„ ë‚´ë¦¬ê³  ì†Œí™”ë¥¼ ë•ìŠµë‹ˆë‹¤.', 
        'íŠ¸ëŸ¬í”Œ ë¦¬ì¡°ë˜':'í ê¸°ìš´ì„ ê°•í™”í•˜ê³  ë©´ì—­ë ¥ì„ ë†’ì…ë‹ˆë‹¤.',
        'í‰ì–‘ëƒ‰ë©´':'ì‹ ì¥ ì›ê¸°ë¥¼ ë³´í•˜ê³  ë…¸í™”ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.'
    };
    const data = {
        'ëª©': { t:'æœ¨: í‘¸ë¥¸ ìƒê¸°', desc:'ê°„(è‚)ì„ ë³´í•˜ê³  ê·¼ìœ¡ í”¼ë¡œë¥¼ í‘¸ëŠ” ì²˜ë°©ì…ë‹ˆë‹¤.', f:{base:['ê·¸ë¦­ ìš”ê±°íŠ¸','ë°”ì§ˆ íŒŒìŠ¤íƒ€'], spring:['ë¯¸ë‚˜ë¦¬ ì‚¼ê²¹ì‚´']}, c:'#5d7a66', k:'í¬ì¼€ ë§›ì§‘' },
        'í™”': { t:'ç«: ë¶‰ì€ ì˜¨ê¸°', desc:'ì‹¬ì¥(å¿ƒ) ìˆœí™˜ì„ ë•ê³  í™”ê¸°ë¥¼ ë‹¤ìŠ¤ë¦¬ëŠ” ì²˜ë°©ì…ë‹ˆë‹¤.', f:{base:['ë§ˆë¼íƒ•','ìœ¡íšŒ ë¹„ë¹”ë°¥'], summer:['ë¬¼íšŒ']}, c:'#a64e4e', k:'ë§ˆë¼íƒ• ë§›ì§‘' },
        'í† ': { t:'åœŸ: í™©ìƒ‰ ì¤‘ì‹¬', desc:'ë¹„ì¥(è„¾)ì„ ë³´ê°•í•˜ê³  ê¸°ë ¥ì„ ì•ˆì°©ì‹œí‚¤ëŠ” ì²˜ë°©ì…ë‹ˆë‹¤.', f:{base:['ë“¤ê¸°ë¦„ ë§‰êµ­ìˆ˜','ë² ì´ê¸€'], autumn:['ë°¤ í‹°ë¼ë¯¸ìˆ˜']}, c:'#c4a46d', k:'ë² ì´ê¸€ ë§›ì§‘' },
        'ê¸ˆ': { t:'é‡‘: ë°±ìƒ‰ ê²°ì‹¤', desc:'í(è‚º) ê¸°ìš´ì„ ë‹¤ì§€ê³  ë©´ì—­ì„ ë†’ì´ëŠ” ì²˜ë°©ì…ë‹ˆë‹¤.', f:{base:['ë‹­í•œë§ˆë¦¬','íŠ¸ëŸ¬í”Œ ë¦¬ì¡°ë˜'], winter:['ì¡°ê°œìˆ ì°œ']}, c:'#8a8a8a', k:'ë‹­í•œë§ˆë¦¬ ë§›ì§‘' },
        'ìˆ˜': { t:'æ°´: ê²€ì€ ì§€í˜œ', desc:'ì‹ ì¥(è…) ì›ê¸°ë¥¼ ì±„ìš°ê³  ì—´ì„ ì‹íˆëŠ” ì²˜ë°©ì…ë‹ˆë‹¤.', f:{base:['í‰ì–‘ëƒ‰ë©´','ëˆì¹´ì¸ '], winter:['ë°©ì–´íšŒ']}, c:'#4e657a', k:'í‰ì–‘ëƒ‰ë©´ ë§›ì§‘' }
    };

    function openModal() { document.getElementById('diagModal').style.display = 'flex'; }

    function finishDiag() {
        const body = document.querySelector('input[name="qBody"]:checked');
        const stress = document.querySelector('input[name="qStress"]:checked');
        const sleep = document.querySelector('input[name="qSleep"]:checked');
        if(!body || !stress || !sleep) return alert("í•­ëª©ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
        document.getElementById('diagModal').style.display = 'none';
        analyze(body.value, stress.value, sleep.value);
    }

    function analyze(body, stress, sleep) {
        const b = document.getElementById('birthDate').value;
        const time = parseInt(document.getElementById('birthTime').value);
        const solar = Solar.fromYmdHms(new Date(b).getFullYear(), new Date(b).getMonth()+1, new Date(b).getDate(), time, 0, 0);
        const tLunar = Solar.fromDate(new Date()).getLunar();
        const map = {'ç”²':'ëª©','ä¹™':'ëª©','å¯…':'ëª©','å¯':'ëª©','ä¸™':'í™”','ä¸':'í™”','å·³':'í™”','åˆ':'í™”','æˆŠ':'í† ','å·±':'í† ','è¾°':'í† ','æˆŒ':'í† ','ä¸‘':'í† ','æœª':'í† ','åºš':'ê¸ˆ','è¾›':'ê¸ˆ','ç”³':'ê¸ˆ','é…‰':'ê¸ˆ','å£¬':'ìˆ˜','ç™¸':'ìˆ˜','äº¥':'ìˆ˜','å­':'ìˆ˜'};
        
        baseCounts = {'ëª©':0,'í™”':0,'í† ':0,'ê¸ˆ':0,'ìˆ˜':0};
        const my8 = solar.getLunar().getEightChar();
        [my8.getYearGan(),my8.getYearZhi(),my8.getMonthGan(),my8.getMonthZhi(),my8.getDayGan(),my8.getDayZhi(),my8.getTimeGan(),my8.getTimeZhi(),tLunar.getDayGan(),tLunar.getDayZhi()].forEach(c => { if(map[c]) baseCounts[map[c]]++; });
        
        currentLack = Object.entries(baseCounts).sort((a,b) => a[1]-b[1])[0][0];

        let advice = `${body} ì²´ì§ˆì´ì‹œêµ°ìš”. `;
        if(stress === 'high') advice += "í˜„ì¬ ë†’ì€ ìŠ¤íŠ¸ë ˆìŠ¤ë¡œ í™”ê¸°ê°€ ìƒì¶©í•˜ë‹ˆ ì°¨ë¶„í•œ ì‹ë‹¨ì´ ê¸¸í•©ë‹ˆë‹¤. ";
        if(sleep === 'bad') advice += "ë¶€ì¡±í•œ ìˆ˜ë©´ìœ¼ë¡œ ê³ ê°ˆëœ ìˆ˜ê¸°ë¥¼ ë³´ì¶©í•´ì•¼ í•©ë‹ˆë‹¤.";

        document.getElementById('dailyInfo').innerText = `${body} | ìŠ¤íŠ¸ë ˆìŠ¤ ${stress==='high'?'ë†’ìŒ':'ì•ˆì •'} | ${tLunar.getDayInGanZhi()}ì¼`;
        document.getElementById('resTitle').innerText = data[currentLack].t;
        document.getElementById('resDesc').innerHTML = `<b>[ì •ë°€ ì§„ë‹¨]</b> ${advice}<br><br>${data[currentLack].desc}`;
        
        const m = new Date().getMonth()+1;
        const season = (m>=3&&m<=5)?'spring':(m>=6&&m<=8)?'summer':(m>=9&&m<=11)?'autumn':'winter';
        const foods = [...(data[currentLack].f[season] || []), ...data[currentLack].f.base];
        document.getElementById('resFoodList').innerHTML = foods.map(f => `<span class="food-tag" onclick="alert('${f}: ${foodEffects[f]||'ë§ì¶¤ ì˜ì–‘ ì‹ë‹¨ì…ë‹ˆë‹¤.'}')">#${f}</span>`).join('');
        
        renderChart(baseCounts);
        document.getElementById('resultArea').style.display = 'block';
    }

    function checkFoodHarmony() {
        const input = document.getElementById('userFoodInput').value.trim();
        if(!input) return;
        let energy = 'ì•Œ ìˆ˜ ì—†ìŒ';
        for(let key in foodFiveElements) { if(input.includes(key)) { energy = foodFiveElements[key]; break; } }
        const res = document.getElementById('harmonyResult');
        if(energy === currentLack) { res.innerText = `âœ… ${input}ì€(ëŠ”) ë¶€ì¡±í•œ ${energy} ê¸°ìš´ì„ ì±„ì›Œì£¼ëŠ” ì°°ë–¡ê¶í•©ì…ë‹ˆë‹¤!`; res.style.color="var(--wood)"; }
        else { res.innerText = `ğŸ§ ${input}ì€(ëŠ”) ${energy} ê¸°ìš´ì´ ê°•í•©ë‹ˆë‹¤. ë¶€ì¡±í•œ ${currentLack} ê¸°ìš´ë„ í•¨ê»˜ ë“œì„¸ìš”.`; res.style.color="var(--ink)"; }
    }

    function renderChart(c) {
        const ctx = document.getElementById('energyChart').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, {
            type: 'radar',
            data: { labels: ['ëª©','í™”','í† ','ê¸ˆ','ìˆ˜'], datasets: [{ data: Object.values(c), backgroundColor: 'rgba(0,0,0,0.05)', borderColor: '#2c2c2c', borderWidth: 1.5 }] },
            options: { scales: { r: { beginAtZero: true, max: 8, ticks: { display: false } } }, plugins: { legend: { display: false } } }
        });
    }

    function saveJournal() {
        const target = document.body;
        html2canvas(target).then(canvas => {
            const a = document.createElement('a'); a.download = 'ì‹ê²°_ì˜¤ëŠ˜ì˜ì²˜ë°©.png'; a.href = canvas.toDataURL(); a.click();
        });
    }

    function searchMap() { window.open(`https://m.map.naver.com/search2/search.naver?query=${encodeURIComponent(data[currentLack].k)}`, '_blank'); }
</script>
</body>
</html>
