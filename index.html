<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ì‹ê²°(é£Ÿçµ) - íŠ¸ë Œë”” ì‚¬ì£¼ ì‹ë‹¨ ì²˜ë°©</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&display=swap');
        :root { --paper: #f4f1ea; --ink: #2c2c2c; --wood: #5d7a66; --fire: #a64e4e; --earth: #c4a46d; --metal: #8a8a8a; --water: #4e657a; }
        body { font-family: 'Noto Serif KR', serif; background-color: #e0ddd5; margin: 0; padding: 20px; color: var(--ink); line-height: 1.6; }
        .app-container { max-width: 450px; margin: auto; background: var(--paper); border: 1px solid #d1cdbf; box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
        .header { padding: 40px 20px; text-align: center; border-bottom: 1px double #d1cdbf; }
        .content { padding: 25px; }
        .section-title { font-size: 0.9rem; font-weight: 700; margin: 20px 0 10px; border-left: 3px solid var(--ink); padding-left: 10px; }
        input, select { width: 100%; border: none; border-bottom: 1px solid #ccc; background: transparent; padding: 12px 5px; margin-bottom: 15px; font-family: inherit; font-size: 1rem; outline: none; box-sizing: border-box; }
        button { width: 100%; padding: 16px; border: 1px solid var(--ink); background: var(--ink); color: white; cursor: pointer; font-family: inherit; transition: 0.3s; margin-top: 10px; }
        #resultArea { display: none; margin-top: 40px; border-top: 2px solid var(--ink); padding-top: 30px; }
        .food-tag { display: inline-block; padding: 6px 12px; margin: 4px; background: #fff; border: 1px solid #ddd; cursor: pointer; border-radius: 20px; font-size: 0.85rem; transition: 0.2s; }
        .food-tag:hover { background: #f9f9f9; border-color: var(--ink); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: var(--paper); width: 85%; max-width: 350px; padding: 30px; border-radius: 2px; text-align: center; }
        #journalCapture { display: none; width: 400px; padding: 50px; background: var(--paper); border: 2px solid var(--ink); color: var(--ink); }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h1 style="letter-spacing: 10px; margin: 0;">é£Ÿ çµ</h1>
        <p style="font-size: 0.8rem; color: #777;">ì˜¤ëŠ˜ì˜ ìš´ëª…ì„ ë§›ìˆê²Œ ì²˜ë°©í•˜ë‹¤</p>
    </div>

    <div class="content">
        <input type="text" id="userNameInput" placeholder="ì„±í•¨ (ë˜ëŠ” í˜¸)">
        <div style="display: flex; gap: 15px; margin-bottom: 15px; font-size: 0.9rem;">
            <label><input type="radio" name="gender" value="ë‚¨" checked> ë‚¨ì„±</label>
            <label><input type="radio" name="gender" value="ì—¬"> ì—¬ì„±</label>
        </div>
        
        <input type="date" id="birthDate" value="1995-01-01">
        <select id="birthCity">
            <option value="127.0">ì„œìš¸/ê²½ê¸° (í‘œì¤€)</option>
            <option value="129.0">ë¶€ì‚°/ìš¸ì‚° (+8ë¶„)</option>
            <option value="126.5">ì¸ì²œ/ì œì£¼ (-2ë¶„)</option>
            <option value="128.6">ëŒ€êµ¬/ê²½ë¶ (+6ë¶„)</option>
        </select>
        <select id="birthTime">
            <option value="0">å­ì‹œ (23:30 ~ 01:29)</option><option value="2">ä¸‘ì‹œ (01:30 ~ 03:29)</option>
            <option value="4">å¯…ì‹œ (03:30 ~ 05:29)</option><option value="6">å¯ì‹œ (05:30 ~ 07:29)</option>
            <option value="8">è¾°ì‹œ (07:30 ~ 09:29)</option><option value="10">å·³ì‹œ (09:30 ~ 11:29)</option>
            <option value="12">åˆì‹œ (11:30 ~ 13:29)</option><option value="14">æœªì‹œ (13:30 ~ 15:29)</option>
            <option value="16">ç”³ì‹œ (15:30 ~ 17:29)</option><option value="18">é…‰ì‹œ (17:30 ~ 19:29)</option>
            <option value="20">æˆŒì‹œ (19:30 ~ 21:29)</option><option value="22">äº¥ì‹œ (21:30 ~ 23:29)</option>
        </select>
        
        <select id="bodyType">
            <option value="unknown">ì²´ì§ˆ: ì˜ ëª¨ë¥´ê² ìŒ (ì§„ë‹¨í•˜ê¸°)</option>
            <option value="íƒœìŒì¸">í—ˆë¦¬ ë°œë‹¬, ê³¨ê²© í¼ (íƒœìŒì¸)</option>
            <option value="ì†ŒìŒì¸">í•˜ì²´ ë°œë‹¬, ì•„ë‹´í•¨ (ì†ŒìŒì¸)</option>
            <option value="ì†Œì–‘ì¸">ìƒì²´ ë°œë‹¬, ì—‰ë©ì´ ê°€ë²¼ì›€ (ì†Œì–‘ì¸)</option>
            <option value="íƒœì–‘ì¸">ëª©ëœë¯¸ê°€ êµµê³  ê¸°ì„¸ê°€ ê°•í•¨ (íƒœì–‘ì¸)</option>
        </select>

        <button onclick="checkAndAnalyze()">ìš´ëª…ì  ì‹ë‹¨ ë¶„ì„</button>

        <div id="resultArea">
            <div id="dailyInfo" style="text-align:center; font-size:0.85rem; color:#888;"></div>
            <div style="height:260px; margin:20px 0;"><canvas id="energyChart"></canvas></div>
            <div class="food-info">
                <div id="resTitle" style="font-size:1.3rem; font-weight:700; color:var(--fire); margin-bottom:10px;"></div>
                <div id="resDesc" style="font-size:0.9rem; color:#666; margin-bottom:15px;"></div>
                <div id="resFoodList"></div>
            </div>
            <button style="background:#fff; color:var(--ink);" onclick="searchMap()">ğŸ“ ì£¼ë³€ ë§›ì§‘ ì¶”ì²œ</button>
            <div id="balanceAdvice" style="text-align:center; font-size:0.85rem; font-weight:700; margin:25px 0;"></div>
            <button onclick="saveJournal()" style="background:#8e735b; border:none;">ğŸ“œ ì‹ë‹¨ ì¼ê¸°ì¥ ì €ì¥</button>
        </div>
    </div>
</div>

<div id="diagModal" class="modal">
    <div class="modal-content">
        <h3>ì²´ì§ˆ ìê°€ì§„ë‹¨</h3>
        <p style="font-size:0.8rem; color:#666;">ê°€ì¥ ê°€ê¹Œìš´ íŠ¹ì§•ì„ ê³¨ë¼ì£¼ì„¸ìš”.</p>
        <div style="text-align:left; margin-top:20px;">
            <label><input type="radio" name="q1" value="íƒœìŒì¸"> ì²´ê²©ì´ í¬ê³  ì†Œí™”ë ¥ì´ ì¢‹ë‹¤</label><br>
            <label><input type="radio" name="q1" value="ì†ŒìŒì¸"> ìƒì²´ë³´ë‹¤ í•˜ì²´ë°œë‹¬, ì†ë°œì´ ì°¨ë‹¤</label><br>
            <label><input type="radio" name="q1" value="ì†Œì–‘ì¸"> ê°€ìŠ´ ë°œë‹¬, ì„±ê²©ì´ ê¸‰í•˜ê³  ì—´ì´ ë§ë‹¤</label>
        </div>
        <button onclick="finishDiag()" style="margin-top:20px;">ì§„ë‹¨ ì™„ë£Œ</button>
    </div>
</div>

<div id="journalContainer" style="position:fixed; left:-9999px;">
    <div id="journalCapture">
        <h2 style="text-align:center; letter-spacing:10px; border-bottom:2px solid #2c2c2c; padding-bottom:15px;">é£Ÿå–® æ—¥è¨˜</h2>
        <div id="jUser" style="margin:20px 0; font-weight:700;"></div>
        <div id="jList" style="margin:30px 0; line-height:2;"></div>
        <div class="sungsun-box"><div id="jSWord" style="font-size:1.6rem; font-weight:700;"></div><div id="jSMean" style="font-size:0.9rem;"></div></div>
    </div>
</div>

<script>
    let chart=null, baseCounts={}, diaryCounts={'ëª©':0,'í™”':0,'í† ':0,'ê¸ˆ':0,'ìˆ˜':0}, diaryLog=[], currentLack='';
    
    const foodEffects = {
        'ê·¸ë¦­ ìš”ê±°íŠ¸ ë³¼': 'í‘¸ë¥¸ ê³¼ì¼ê³¼ ìœ ì‚°ê· ì´ ê°„ í•´ë…ê³¼ ìƒê¸°ë¥¼ ê¹¨ì›ë‹ˆë‹¤.',
        'ë°”ì§ˆ í˜ìŠ¤í†  íŒŒìŠ¤íƒ€': 'ì‹ ì„ í•œ í—ˆë¸Œ í–¥ì´ ê°„ ê¸°ìš´ì˜ ì •ì²´ë¥¼ í’€ì–´ì¤ë‹ˆë‹¤.',
        'ë§ˆë¼íƒ•(1ë‹¨ê³„)': 'ì‹¬ì¥ì˜ í™”ê¸°ë¥¼ ìê·¹í•´ í˜ˆí–‰ê³¼ ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œë¥¼ ë•ìŠµë‹ˆë‹¤.',
        'ë°¤ í‹°ë¼ë¯¸ìˆ˜': 'ë‹¬ì½¤í•œ ë°¤ì˜ ê¸°ìš´ì´ ë¹„ìœ„ì˜ ë¶€ì¡±í•œ ì—ë„ˆì§€ë¥¼ ì±„ì›ë‹ˆë‹¤.',
        'íŠ¸ëŸ¬í”Œ í¬ë¦¼ ë¦¬ì¡°ë˜': 'í ê¸°ìš´ì„ ì‘ì§‘ì‹œì¼œ ë©´ì—­ë ¥ì„ ê°•í™”í•˜ê³  ë§ˆìŒì„ ì•ˆì •ì‹œí‚µë‹ˆë‹¤.',
        'í‰ì–‘ëƒ‰ë©´': 'ë§‘ì€ ìœ¡ìˆ˜ê°€ ì‹ ì¥ì˜ ìˆ˜ë¶„ ëŒ€ì‚¬ë¥¼ ë•ê³  ì—´ì„ ì‹í˜€ì¤ë‹ˆë‹¤.'
    };

    const data = {
        'ëª©': { t:'æœ¨: í‘¸ë¥¸ ìƒê¸° ì²˜ë°©', desc:'ê°„(è‚)ì˜ ê¸°ìš´ì„ ë•ëŠ” ì‹±ê·¸ëŸ¬ìš´ ì‹ë‹¨ì…ë‹ˆë‹¤.', f:{base:['ê·¸ë¦­ ìš”ê±°íŠ¸ ë³¼','ë°”ì§ˆ í˜ìŠ¤í†  íŒŒìŠ¤íƒ€','í¬ì¼€'], spring:['ë¯¸ë‚˜ë¦¬ ì‚¼ê²¹ì‚´','ë‹¬ë˜ íŒŒìŠ¤íƒ€'], winter:['ì‹œê¸ˆì¹˜ í”„ë¦¬íƒ€íƒ€']}, c:'#5d7a66', k:'í¬ì¼€ ìƒëŸ¬ë“œ ë§›ì§‘' },
        'í™”': { t:'ç«: ë¶‰ì€ ì˜¨ê¸° ì²˜ë°©', desc:'ì‹¬ì¥(å¿ƒ)ì˜ ì—´ì„ ë‹¤ìŠ¤ë¦¬ëŠ” í™œê¸°ì°¬ ì‹ë‹¨ì…ë‹ˆë‹¤.', f:{base:['ë§ˆë¼íƒ•(1ë‹¨ê³„)','ë§ˆë¥´ê²Œë¦¬ë”° í”¼ì','ë‚™ê³±ìƒˆ'], summer:['ë¬¼íšŒ','ì•„ì‚¬ì´ë³¼'], autumn:['ìëª½ íƒ€ë¥´íŠ¸']}, c:'#a64e4e', k:'ë§ˆë¼íƒ• ë‚™ê³±ìƒˆ ë§›ì§‘' },
        'í† ': { t:'åœŸ: í™©ìƒ‰ ì¤‘ì‹¬ ì²˜ë°©', desc:'ë¹„ì¥(è„¾)ì„ ë³´ê°•í•˜ëŠ” í¸ì•ˆí•œ ì‹ë‹¨ì…ë‹ˆë‹¤.', f:{base:['ë“¤ê¸°ë¦„ ë§‰êµ­ìˆ˜','ë² ì´ê¸€','ë‹¨í˜¸ë°• ë‡¨ë¼'], autumn:['ë°¤ í‹°ë¼ë¯¸ìˆ˜','ê³ êµ¬ë§ˆ íœ˜ë‚­ì‹œì—'], spring:['ì˜¥ìˆ˜ìˆ˜ ì†¥ë°¥']}, c:'#c4a46d', k:'ë§‰êµ­ìˆ˜ ë² ì´ê¸€ ë§›ì§‘' },
        'ê¸ˆ': { t:'é‡‘: ë°±ìƒ‰ ê²°ì‹¤ ì²˜ë°©', desc:'í(è‚º)ì˜ ê¸°ìš´ì„ ì‘ì§‘ì‹œí‚¤ëŠ” ë‹´ë°±í•œ ì‹ë‹¨ì…ë‹ˆë‹¤.', f:{base:['ë‹­í•œë§ˆë¦¬','íŠ¸ëŸ¬í”Œ í¬ë¦¼ ë¦¬ì¡°ë˜','êµ´ íŒŒìŠ¤íƒ€'], autumn:['ë°° ì†Œë¥´ë² '], winter:['ì¡°ê°œìˆ ì°œ']}, c:'#8a8a8a', k:'ë‹­í•œë§ˆë¦¬ ë¦¬ì¡°ë˜ ë§›ì§‘' },
        'ìˆ˜': { t:'æ°´: ê²€ì€ ì§€ë¡€ ì²˜ë°©', desc:'ì‹ ì¥(è…) ì›ê¸°ë¥¼ ì±„ìš°ëŠ” ê¹Šì€ í’ë¯¸ì˜ ì‹ë‹¨ì…ë‹ˆë‹¤.', f:{base:['í‰ì–‘ëƒ‰ë©´','ëˆì¹´ì¸ ','ì „ë³µ ì†¥ë°¥'], winter:['ë°©ì–´íšŒ'], summer:['ì¥ì–´ë®ë°¥']}, c:'#4e657a', k:'í‰ì–‘ëƒ‰ë©´ ëˆì¹´ì¸  ë§›ì§‘' }
    };

    function getCurrentSeason() {
        const m = new Date().getMonth()+1;
        if(m>=3 && m<=5) return 'spring'; if(m>=6 && m<=8) return 'summer'; if(m>=9 && m<=11) return 'autumn'; return 'winter';
    }

    function checkAndAnalyze() {
        if(document.getElementById('bodyType').value === 'unknown') document.getElementById('diagModal').style.display='flex';
        else analyze();
    }

    function finishDiag() {
        const q = document.querySelector('input[name="q1"]:checked');
        if(!q) return alert("ì²´í¬í•´ ì£¼ì„¸ìš”.");
        document.getElementById('bodyType').value = q.value;
        document.getElementById('diagModal').style.display='none';
        analyze();
    }

    function analyze() {
        const b=document.getElementById('birthDate').value;
        const solar=Solar.fromYmdHms(new Date(b).getFullYear(), new Date(b).getMonth()+1, new Date(b).getDate(), parseInt(document.getElementById('birthTime').value), 0, 0);
        const tLunar=Solar.fromDate(new Date()).getLunar();
        const map={'ç”²':'ëª©','ä¹™':'ëª©','å¯…':'ëª©','å¯':'ëª©','ä¸™':'í™”','ä¸':'í™”','å·³':'í™”','åˆ':'í™”','æˆŠ':'í† ','å·±':'í† ','è¾°':'í† ','æˆŒ':'í† ','ä¸‘':'í† ','æœª':'í† ','åºš':'ê¸ˆ','è¾›':'ê¸ˆ','ç”³':'ê¸ˆ','é…‰':'ê¸ˆ','å£¬':'ìˆ˜','ç™¸':'ìˆ˜','äº¥':'ìˆ˜','å­':'ìˆ˜'};
        baseCounts={'ëª©':0,'í™”':0,'í† ':0,'ê¸ˆ':0,'ìˆ˜':0};
        const my8=solar.getLunar().getEightChar();
        [my8.getYearGan(),my8.getYearZhi(),my8.getMonthGan(),my8.getMonthZhi(),my8.getDayGan(),my8.getDayZhi(),my8.getTimeGan(),my8.getTimeZhi(),tLunar.getDayGan(),tLunar.getDayZhi()].forEach(c=>{if(map[c])baseCounts[map[c]]++;});
        
        currentLack=Object.entries(baseCounts).sort((a,b)=>a[1]-b[1])[0][0];
        const body=document.getElementById('bodyType').value;
        const season=getCurrentSeason();
        const seasonLabels={spring:'ğŸŒ¸ ë´„', summer:'â˜€ï¸ ì—¬ë¦„', autumn:'ğŸ‚ ê°€ì„', winter:'â„ï¸ ê²¨ìš¸'};

        document.getElementById('dailyInfo').innerText=`${body} | ${seasonLabels[season]} ì‹œì¦Œ | ${tLunar.getDayInGanZhi()}ì¼`;
        document.getElementById('resTitle').innerText=`${body} ë§ì¶¤ ${data[currentLack].t}`;
        document.getElementById('resDesc').innerHTML=data[currentLack].desc;
        
        // ë©”ë‰´ ì¶œë ¥ ë° íš¨ëŠ¥ íŒì—… ì—°ê²°
        const foods = [...(data[currentLack].f[season] || []), ...data[currentLack].f.base];
        document.getElementById('resFoodList').innerHTML = foods.map(f => `<span class="food-tag" onclick="showFood('${f}')">#${f}</span>`).join('');
        
        renderChart(baseCounts);
        document.getElementById('resultArea').style.display='block';
    }

    function showFood(name) {
        const effect = foodEffects[name] || "ê·€í•˜ì˜ ì˜¤í–‰ ê· í˜•ì„ ë§ì¶”ëŠ” ìµœì ì˜ íŠ¸ë Œë”” ë©”ë‰´ì…ë‹ˆë‹¤.";
        if(confirm(`[${name}ì˜ íš¨ëŠ¥]\n${effect}\n\nì§€ê¸ˆ ë“œì…¨ë‚˜ìš”? (ê¸°ë¡í•˜ê¸°)`)) addDiary(currentLack, name);
    }

    function addDiary(type, name) {
        diaryCounts[type]++;
        diaryLog.push({n:name, t:new Date().toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'})});
        const final={}; for(let k in baseCounts) final[k]=baseCounts[k]+diaryCounts[k];
        const sorted=Object.entries(final).sort((a,b)=>a[1]-b[1]);
        document.getElementById('balanceAdvice').innerText= (sorted[4][1]-sorted[0][1]<=1) ? "â˜¯ï¸ ì™„ë²½í•œ ì¤‘í™” ìƒíƒœì…ë‹ˆë‹¤!" : `'${sorted[0][0]}' ê¸°ìš´ì„ ì¡°ê¸ˆ ë” ì±„ìš°ì„¸ìš”.`;
    }

    function renderChart(c){
        const ctx=document.getElementById('energyChart').getContext('2d');
        if(chart) chart.destroy();
        chart=new Chart(ctx,{type:'radar',data:{labels:['ëª©','í™”','í† ','ê¸ˆ','ìˆ˜'],datasets:[{data:[c['ëª©'],c['í™”'],c['í† '],c['ê¸ˆ'],c['ìˆ˜']],backgroundColor:'rgba(0,0,0,0.05)',borderColor:'#2c2c2c',borderWidth:1}]},options:{scales:{r:{beginAtZero:true,max:7,ticks:{display:false}}},plugins:{legend:{display:false}}}});
    }

    function saveJournal() {
        const name=document.getElementById('userNameInput').value||"ê·€í•˜";
        document.getElementById('jDate').innerText=new Date().toLocaleDateString();
        document.getElementById('jUser').innerText=`${name} ë‹˜ì˜ ì‹ê²° ë³´ì „`;
        document.getElementById('jList').innerHTML=diaryLog.map(l=>`<div><b>[${l.t}]</b> ${l.n} ì„­ì·¨</div>`).join('');
        const lackEl = Object.entries(baseCounts).sort((a,b)=>a[1]-b[1])[0][0];
        const s = (lackEl === 'ëª©') ? {w:'æ¯æœ¨é€¢æ˜¥', m:'ë´„ì˜ ìƒê¸°ê°€ ê¹ƒë“­ë‹ˆë‹¤.'} : {w:'ä¸Šå–„è‹¥æ°´', m:'ìœ ì—°í•œ ì§€í˜œë¥¼ ì–»ìŠµë‹ˆë‹¤.'};
        document.getElementById('jSWord').innerText=s.w; document.getElementById('jSMean').innerText=s.m;
        const target=document.getElementById('journalCapture'); target.style.display='block';
        html2canvas(target,{scale:2}).then(canvas=>{const a=document.createElement('a'); a.download=`ì‹ê²°_ì¼ê¸°.png`; a.href=canvas.toDataURL(); a.click(); target.style.display='none';});
    }
    function searchMap(){window.open(`https://m.map.naver.com/search2/search.naver?query=${encodeURIComponent(data[currentLack].k)}`,'_blank');}
</script>
</body>
</html>
