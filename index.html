<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ì‹ê²°(é£Ÿçµ) - ë§ˆìŠ¤í„° ì²´ì§ˆ ì²˜ë°©</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&display=swap');
        :root { --paper: #f4f1ea; --ink: #2c2c2c; --wood: #5d7a66; --fire: #a64e4e; --earth: #c4a46d; --metal: #8a8a8a; --water: #4e657a; }
        body { font-family: 'Noto Serif KR', serif; background-color: #e0ddd5; margin: 0; padding: 20px; color: var(--ink); line-height: 1.6; }
        .app-container { max-width: 450px; margin: auto; background: var(--paper); border: 1px solid #d1cdbf; box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
        .header { padding: 40px 20px; text-align: center; border-bottom: 1px double #d1cdbf; }
        .content { padding: 25px; }
        .section-title { font-size: 0.9rem; font-weight: 700; margin: 20px 0 10px; border-left: 3px solid var(--ink); padding-left: 10px; }
        input, select { width: 100%; border: none; border-bottom: 1px solid #ccc; background: transparent; padding: 12px 5px; margin-bottom: 15px; font-family: inherit; font-size: 1rem; outline: none; box-sizing: border-box; }
        button { width: 100%; padding: 16px; border: 1px solid var(--ink); background: var(--ink); color: white; cursor: pointer; font-family: inherit; transition: 0.3s; margin-top: 10px; }
        #resultArea { display: none; margin-top: 40px; border-top: 2px solid var(--ink); padding-top: 30px; }
        .food-info { background: rgba(0,0,0,0.02); padding: 20px; border-radius: 4px; margin: 25px 0; }
        .diary-btns { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin: 20px 0; }
        .diary-btns button { padding: 8px 2px; font-size: 0.7rem; border-radius: 4px; margin-top: 0; }
        
        /* ìê°€ì§„ë‹¨ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: var(--paper); width: 90%; max-width: 380px; padding: 30px; border-radius: 2px; position: relative; }
        .q-item { margin-bottom: 20px; font-size: 0.9rem; }
        
        #journalCapture { display: none; width: 400px; padding: 50px; background: var(--paper); border: 2px solid var(--ink); color: var(--ink); position: relative; }
        .sungsun-box { margin-top: 30px; padding: 20px; border: 1px double var(--ink); text-align: center; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h1 style="letter-spacing: 10px; margin: 0;">é£Ÿ çµ</h1>
        <p style="font-size: 0.8rem; color: #777;">ì‚¬ì£¼Â·ì²´ì§ˆÂ·ê´€ìƒì˜ ì¡°í™”ë¥¼ ë‹´ì€ ì²˜ë°©</p>
    </div>

    <div class="content">
        <div class="section-title">ê¸°ë³¸ ì •ë³´</div>
        <input type="text" id="userNameInput" placeholder="ì„±í•¨ (ë˜ëŠ” í˜¸)">
        <div style="display: flex; gap: 15px; margin-bottom: 15px; font-size: 0.9rem;">
            <label><input type="radio" name="gender" value="ë‚¨" checked> ë‚¨ì„±</label>
            <label><input type="radio" name="gender" value="ì—¬"> ì—¬ì„±</label>
        </div>
        
        <div class="section-title">íƒœì–´ë‚œ ë•Œì™€ ì¥ì†Œ</div>
        <input type="date" id="birthDate" value="1995-01-01">
        <select id="birthCity">
            <option value="127.0">ì„œìš¸/ê²½ê¸° (í‘œì¤€)</option>
            <option value="129.0">ë¶€ì‚°/ìš¸ì‚° (+8ë¶„)</option>
            <option value="126.5">ì¸ì²œ/ì œì£¼ (-2ë¶„)</option>
            <option value="128.6">ëŒ€êµ¬/ê²½ë¶ (+6ë¶„)</option>
            <option value="127.4">ëŒ€ì „/ì¶©ì²­ (+2ë¶„)</option>
            <option value="126.9">ê´‘ì£¼/ì „ë¼ (-1ë¶„)</option>
        </select>
        <select id="birthTime">
            <option value="0">å­ì‹œ (23:30 ~ 01:29)</option><option value="2">ä¸‘ì‹œ (01:30 ~ 03:29)</option>
            <option value="4">å¯…ì‹œ (03:30 ~ 05:29)</option><option value="6">å¯ì‹œ (05:30 ~ 07:29)</option>
            <option value="8">è¾°ì‹œ (07:30 ~ 09:29)</option><option value="10">å·³ì‹œ (09:30 ~ 11:29)</option>
            <option value="12">åˆì‹œ (11:30 ~ 13:29)</option><option value="14">æœªì‹œ (13:30 ~ 15:29)</option>
            <option value="16">ç”³ì‹œ (15:30 ~ 17:29)</option><option value="18">é…‰ì‹œ (17:30 ~ 19:29)</option>
            <option value="20">æˆŒì‹œ (19:30 ~ 21:29)</option><option value="22">äº¥ì‹œ (21:30 ~ 23:29)</option>
        </select>
        <label style="font-size: 0.8rem; color: var(--fire);"><input type="checkbox" id="isYajasi"> ë°¤ 23:30 ~ 24:00 (ì•¼ìì‹œ) ì¶œìƒ</label>

        <div class="section-title">ê´€ìƒ ë° ì²´ì§ˆ ìê°€ ì²´í¬</div>
        <select id="faceType">
            <option value="unknown">ê´€ìƒ: ì˜ ëª¨ë¥´ê² ìŒ (ë¯¸í™•ì¸)</option>
            <option value="ëª©">ê¸¸ì­‰í•˜ê³  ê³§ì€ ì„ ë¹„ìƒ (æœ¨)</option>
            <option value="í™”">ë‚ ì¹´ë¡­ê³  ë¶‰ì€ ê¸°ìš´ì˜ ìƒ (ç«)</option>
            <option value="í† ">ë‘¥ê¸€ê³  ë‘í„°ìš´ ì¸ìí•œ ìƒ (åœŸ)</option>
            <option value="ê¸ˆ">ê°ì§€ê³  í•˜ì–—ë©° ê°•ë‹¨ ìˆëŠ” ìƒ (é‡‘)</option>
            <option value="ìˆ˜">ë™ê¸€ë™ê¸€í•˜ê³  ì´ëª©êµ¬ë¹„ê°€ í° ìƒ (æ°´)</option>
        </select>
        <select id="bodyType">
            <option value="unknown">ì²´ì§ˆ: ì˜ ëª¨ë¥´ê² ìŒ (ì§„ë‹¨í•˜ê¸°)</option>
            <option value="íƒœìŒì¸">í—ˆë¦¬ê°€ ë°œë‹¬í•˜ê³  ê³¨ê²©ì´ í¼ (íƒœìŒì¸)</option>
            <option value="ì†ŒìŒì¸">í•˜ì²´ê°€ ë°œë‹¬í•˜ê³  ì²´êµ¬ê°€ ì•„ë‹´í•¨ (ì†ŒìŒì¸)</option>
            <option value="ì†Œì–‘ì¸">ê°€ìŠ´ì´ ë°œë‹¬í•˜ê³  ì—‰ë©ì´ê°€ ê°€ë²¼ì›€ (ì†Œì–‘ì¸)</option>
            <option value="íƒœì–‘ì¸">ëª©ëœë¯¸ê°€ êµµê³  ê¸°ì„¸ê°€ ê°•í•¨ (íƒœì–‘ì¸)</option>
        </select>

        <button onclick="checkAndAnalyze()">ì •ë°€ ê¸°ìš´ ë¶„ì„ ì‹œì‘</button>

        <div id="resultArea">
            <div id="dailyFortune" style="text-align:center; font-size:0.85rem; color:#888; margin-bottom:20px;"></div>
            <div style="height:260px; margin:20px 0;"><canvas id="energyChart"></canvas></div>
            <div class="food-info">
                <div id="resTitle" style="font-size:1.3rem; font-weight:700; color:var(--fire); margin-bottom:10px;"></div>
                <div id="resDesc" style="font-size:0.9rem; color:#666; margin-bottom:15px; line-height:1.8;"></div>
                <div id="resFood" style="font-size:0.95rem; border-top:1px dashed #ccc; padding-top:15px;"></div>
            </div>
            <button style="background:#fff; color:var(--ink);" onclick="searchMap()">ğŸ“ ë‚´ ì£¼ë³€ ë§ì¶¤ ë§›ì§‘ ì°¾ê¸°</button>
            <div class="diary-btns">
                <button style="background:#f0f7f0; color:var(--wood);" onclick="addDiary('ëª©')">ğŸŒ¿ëª©</button>
                <button style="background:#fff5f5; color:var(--fire);" onclick="addDiary('í™”')">ğŸ”¥í™”</button>
                <button style="background:#fffdf5; color:var(--earth);" onclick="addDiary('í† ')">â›°ï¸í† </button>
                <button style="background:#f5f5f5; color:var(--metal);" onclick="addDiary('ê¸ˆ')">ğŸ’ê¸ˆ</button>
                <button style="background:#f5f8fa; color:var(--water);" onclick="addDiary('ìˆ˜')">ğŸŒŠìˆ˜</button>
            </div>
            <div id="balanceAdvice" style="text-align:center; font-size:0.85rem; font-weight:700; margin-bottom:20px;"></div>
            <button onclick="saveJournal()" style="background:#8e735b; border:none;">ğŸ“œ ì •ë°€ ì‹ë‹¨ ì¼ê¸°ì¥ ì €ì¥</button>
        </div>
    </div>
</div>

<div id="diagModal" class="modal">
    <div class="modal-content">
        <h3 style="text-align:center; margin-bottom:20px;">ì²´ì§ˆ ìê°€ì§„ë‹¨</h3>
        <div class="q-item">
            <b>1. ì²´ê²©ì´ ì–´ë– ì‹ ê°€ìš”?</b><br>
            <label><input type="radio" name="q1" value="íƒœìŒì¸"> ê³¨ê²©ì´ í¬ê³  ì²´ì¤‘ì´ ì˜ ëŠš</label><br>
            <label><input type="radio" name="q1" value="ì†ŒìŒì¸"> ìƒì²´ë³´ë‹¤ í•˜ì²´ê°€ ë°œë‹¬, ì•„ë‹´í•¨</label><br>
            <label><input type="radio" name="q1" value="ì†Œì–‘ì¸"> ê°€ìŠ´ìª½ì´ ë°œë‹¬, ì—‰ë©ì´ê°€ ê°€ë²¼ì›€</label>
        </div>
        <div class="q-item">
            <b>2. í‰ì†Œ ì†Œí™” ìƒíƒœëŠ”?</b><br>
            <label><input type="radio" name="q2" value="íƒœìŒì¸"> ë¬´ì—‡ì´ë“  ì˜ ë¨¹ê³  ì†Œí™”ë ¥ ì¢‹ìŒ</label><br>
            <label><input type="radio" name="q2" value="ì†ŒìŒì¸"> ìœ„ì¥ì´ ì•½í•´ ì†Œí™”ê°€ ìì£¼ ì•ˆ ë¨</label><br>
            <label><input type="radio" name="q2" value="ì†Œì–‘ì¸"> ì—´ê¸°ê°€ ë§ì•„ ë³€ë¹„ê°€ ìì£¼ ìƒê¹€</label>
        </div>
        <button onclick="finishDiag()">ì§„ë‹¨ ì™„ë£Œ ë° ë¶„ì„</button>
    </div>
</div>

<div id="journalContainer" style="position:fixed; left:-9999px;">
    <div id="journalCapture">
        <div id="jDate" style="text-align:right; font-size:0.8rem;"></div>
        <h2 style="text-align:center; letter-spacing:15px; border-bottom:2px solid #2c2c2c; padding-bottom:15px;">é£Ÿå–® æ—¥è¨˜</h2>
        <div id="jUser" style="margin:20px 0; font-weight:700; font-size:1.1rem;"></div>
        <div id="jList" style="margin:30px 0; min-height:150px;"></div>
        <div class="sungsun-box"><div id="jSWord" style="font-size:1.6rem; font-weight:700; margin-bottom:10px;"></div><div id="jSMean" style="font-size:0.9rem;"></div></div>
        <div style="text-align:center; margin-top:40px; opacity:0.3; font-size:0.7rem;">SIKGYEOL MASTER</div>
    </div>
</div>

<script>
    let chart=null, baseCounts={}, diaryCounts={'ëª©':0,'í™”':0,'í† ':0,'ê¸ˆ':0,'ìˆ˜':0}, diaryLog=[], currentLack='';
    const data={'ëª©':{t:'æœ¨: í‘¸ë¥¸ ìƒê¸°', desc:'ê°„ ê¸°ìš´ì„ ë•ê³  ê·¼ìœ¡ ê¸´ì¥ì„ í‘¸ëŠ” ì²˜ë°©ì…ë‹ˆë‹¤.', f:'ë³´ë¦¬, ë¶€ì¶”, ë¯¸ë‚˜ë¦¬, ë§¤ì‹¤', c:'#5d7a66', k:'ìƒëŸ¬ë“œ ë³´ë¦¬ë°¥ ë‹­ìš”ë¦¬'},'í™”':{t:'ç«: ë¶‰ì€ ì˜¨ê¸°', desc:'ì‹¬ì—´ì„ ë‚´ë¦¬ê³  í˜ˆí–‰ì„ ë•ëŠ” ì²˜ë°©ì…ë‹ˆë‹¤.', f:'ìˆ˜ìˆ˜, í† ë§ˆí† , ìƒì¶”, ìëª½', c:'#a64e4e', k:'ì†Œê³ ê¸°êµ¬ì´ íŒŒìŠ¤íƒ€ ë§¤ìš´íƒ•'},'í† ':{t:'åœŸ: í™©ìƒ‰ ì¤‘ì‹¬', desc:'ë¹„ìœ„ë¥¼ ë³´ê°•í•˜ê³  ì†Œí™”ë¥¼ ë•ëŠ” ì²˜ë°©ì…ë‹ˆë‹¤.', f:'í˜„ë¯¸, ê³ êµ¬ë§ˆ, ë‹¨í˜¸ë°•, ê¿€', c:'#c4a46d', k:'í•œì •ì‹ ì²­êµ­ì¥ ë‘ë¶€ìš”ë¦¬'},'ê¸ˆ':{t:'é‡‘: ë°±ìƒ‰ ê²°ì‹¤', desc:'íì™€ í˜¸í¡ê¸° ë©´ì—­ì„ ë‹¤ì§€ëŠ” ì²˜ë°©ì…ë‹ˆë‹¤.', f:'í°ìŒ€, ë¬´, ë„ë¼ì§€, ìƒê°•', c:'#8a8a8a', k:'ìƒì„ íšŒ ì„¤ë íƒ• ì¡°ê°œêµ¬ì´'},'ìˆ˜':{t:'æ°´: ê²€ì€ ì§€í˜œ', desc:'ì‹ ì¥ê³¼ í•˜ì²´ì˜ ì›ê¸°ë¥¼ ì±„ìš°ëŠ” ì²˜ë°©ì…ë‹ˆë‹¤.', f:'í‘ë¯¸, ê²€ì€ì½©, ë¯¸ì—­, ë¸”ë£¨ë² ë¦¬', c:'#4e657a', k:'ë¼ì§€êµ­ë°¥ í•´ì‚°ë¬¼ ë¯¸ì—­êµ­'}};
    
    function checkAndAnalyze() {
        if(document.getElementById('bodyType').value === 'unknown') {
            document.getElementById('diagModal').style.display = 'flex';
        } else { analyze(); }
    }

    function finishDiag() {
        const q1 = document.querySelector('input[name="q1"]:checked');
        const q2 = document.querySelector('input[name="q2"]:checked');
        if(!q1 || !q2) return alert("ë¬¸í•­ì— ë‹µí•´ì£¼ì„¸ìš”.");
        document.getElementById('bodyType').value = q1.value;
        document.getElementById('diagModal').style.display = 'none';
        analyze();
    }

    function analyze(){
        const b=document.getElementById('birthDate').value;
        const solar=Solar.fromYmdHms(new Date(b).getFullYear(), new Date(b).getMonth()+1, new Date(b).getDate(), parseInt(document.getElementById('birthTime').value), 0, 0);
        const tLunar=Solar.fromDate(new Date()).getLunar();
        const map={'ç”²':'ëª©','ä¹™':'ëª©','å¯…':'ëª©','å¯':'ëª©','ä¸™':'í™”','ä¸':'í™”','å·³':'í™”','åˆ':'í™”','æˆŠ':'í† ','å·±':'í† ','è¾°':'í† ','æˆŒ':'í† ','ä¸‘':'í† ','æœª':'í† ','åºš':'ê¸ˆ','è¾›':'ê¸ˆ','ç”³':'ê¸ˆ','é…‰':'ê¸ˆ','å£¬':'ìˆ˜','ç™¸':'ìˆ˜','äº¥':'ìˆ˜','å­':'ìˆ˜'};
        baseCounts={'ëª©':0,'í™”':0,'í† ':0,'ê¸ˆ':0,'ìˆ˜':0};
        const my8=solar.getLunar().getEightChar();
        [my8.getYearGan(),my8.getYearZhi(),my8.getMonthGan(),my8.getMonthZhi(),my8.getDayGan(),my8.getDayZhi(),my8.getTimeGan(),my8.getTimeZhi(),tLunar.getDayGan(),tLunar.getDayZhi()].forEach(c=>{if(map[c])baseCounts[map[c]]++;});
        
        currentLack=Object.entries(baseCounts).sort((a,b)=>a[1]-b[1])[0][0];
        const body=document.getElementById('bodyType').value;
        const face=document.getElementById('faceType').value === 'unknown' ? 'ìˆœìˆ˜ ê¸°ìš´' : document.getElementById('faceType').value;

        document.getElementById('dailyFortune').innerText=`${body} | ${face} | ${tLunar.getDayInGanZhi()}ì¼`;
        document.getElementById('resTitle').innerText=`${body}ì„ ìœ„í•œ ${data[currentLack].t}`;
        document.getElementById('resDesc').innerHTML=`<b>[ë¶„ì„]</b> ${body} ì²´ì§ˆì— ë§ì¶° '${currentLack}' ê¸°ìš´ì„ ë³´ê°•í•©ë‹ˆë‹¤.<br>${data[currentLack].desc}`;
        document.getElementById('resFood').innerHTML=data[currentLack].f;
        
        drawChart(baseCounts);
        document.getElementById('resultArea').style.display='block';
    }

    function drawChart(c){
        const ctx=document.getElementById('energyChart').getContext('2d');
        if(chart) chart.destroy();
        chart=new Chart(ctx,{type:'radar',data:{labels:['ëª©','í™”','í† ','ê¸ˆ','ìˆ˜'],datasets:[{data:[c['ëª©'],c['í™”'],c['í† '],c['ê¸ˆ'],c['ìˆ˜']],backgroundColor:'rgba(44,44,44,0.08)',borderColor:'#2c2c2c',borderWidth:1.5}]},options:{scales:{r:{beginAtZero:true,max:7,ticks:{display:false}}},plugins:{legend:{display:false}}}});
    }

    function addDiary(type){
        diaryCounts[type]++; diaryLog.push({t:type, time:new Date().toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'})});
        const final={}; for(let k in baseCounts) final[k]=baseCounts[k]+diaryCounts[k];
        const sorted=Object.entries(final).sort((a,b)=>a[1]-b[1]);
        document.getElementById('balanceAdvice').innerText= (sorted[4][1]-sorted[0][1]<=1) ? "â˜¯ï¸ ì™„ë²½í•œ ì¤‘í™” ë‹¬ì„±!" : `'${sorted[0][0]}' ê¸°ìš´ì´ ë” í•„ìš”í•©ë‹ˆë‹¤.`;
    }

    function saveJournal(){
        const name=document.getElementById('userNameInput').value||"ê·€í•˜";
        document.getElementById('jDate').innerText=new Date().toLocaleDateString();
        document.getElementById('jUser').innerText=`${name} ë‹˜ì˜ ì‹ê²° ë³´ì „`;
        document.getElementById('jList').innerHTML=diaryLog.map(l=>`<div><b>[${l.time}]</b> ${l.t}ê¸°ìš´ ì„­ì·¨</div>`).join('');
        const s = (Object.entries(baseCounts).sort((a,b)=>a[1]-b[1])[0][0] === 'ëª©') ? {w:'æ¯æœ¨é€¢æ˜¥', m:'ë´„ì˜ ìƒê¸°ê°€ ê¹ƒë“­ë‹ˆë‹¤.'} : {w:'ä¸Šå–„è‹¥æ°´', m:'ìœ ì—°í•œ ì§€í˜œë¥¼ ì–»ìŠµë‹ˆë‹¤.'};
        document.getElementById('jSWord').innerText=s.w; document.getElementById('jSMean').innerText=s.m;
        const target=document.getElementById('journalCapture'); target.style.display='block';
        html2canvas(target,{scale:2}).then(canvas=>{const a=document.createElement('a'); a.download=`ì‹ê²°_ì¼ê¸°.png`; a.href=canvas.toDataURL(); a.click(); target.style.display='none';});
    }
    function searchMap(){window.open(`https://m.map.naver.com/search2/search.naver?query=${encodeURIComponent(data[currentLack].k)}`,'_blank');}
</script>
</body>
</html>
