<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹ê²°(é£Ÿçµ) - ì‚¬ì£¼ ë§ì¶¤ ì‹ë‹¨ ì²˜ë°©</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --wood: #4CAF50; --fire: #F44336; --earth: #FFC107;
            --metal: #9E9E9E; --water: #2196F3; --bg: #F8F9FA;
        }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg); margin: 0; padding: env(safe-area-inset-top) 20px 40px; color: #333; line-height: 1.6; }
        .app-container { max-width: 450px; margin: auto; background: white; border-radius: 30px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.1); }
        .header { background: #1a1a1a; color: white; padding: 40px 20px; text-align: center; }
        .header h1 { margin: 0; font-size: 1.8rem; letter-spacing: 4px; font-weight: 800; }
        
        .content { padding: 25px; }
        .input-card { background: #fdfdfd; border: 1px solid #eee; padding: 20px; border-radius: 20px; margin-bottom: 25px; }
        label { font-size: 0.8rem; color: #888; display: block; margin-bottom: 8px; font-weight: 700; }
        input, select { width: 100%; border: none; background: #f0f0f0; padding: 15px; border-radius: 12px; margin-bottom: 15px; font-size: 1rem; box-sizing: border-box; }
        
        button { width: 100%; padding: 18px; border: none; border-radius: 15px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-main { background: #1a1a1a; color: white; }
        .btn-main:hover { background: #333; }
        
        #resultArea { display: none; margin-top: 20px; animation: fadeInUp 0.6s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        #captureArea { padding: 20px; background: white; border-radius: 20px; }
        .chart-container { position: relative; height: 280px; margin: 10px 0; }
        
        .card { padding: 20px; border-radius: 18px; margin-top: 15px; }
        .solution { background: #f0f7f0; border-left: 5px solid var(--wood); }
        .avoid { background: #fff5f5; border-left: 5px solid var(--fire); display: none; }
        .badge { display: inline-block; padding: 4px 12px; border-radius: 20px; color: white; font-size: 0.75rem; font-weight: bold; margin-bottom: 10px; }
        
        .action-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 25px; }
        .btn-sub { background: #eee; color: #555; font-size: 0.9rem; }
        .btn-save { background: #ff5722; color: white; font-size: 0.9rem; }

        footer { text-align: center; font-size: 0.7rem; color: #ccc; margin-top: 30px; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h1>é£Ÿ çµ</h1>
        <p style="opacity: 0.6; font-size: 0.85rem; margin-top: 8px;">ë‚˜ì˜ ì‚¬ì£¼ ì²´ì§ˆì— ë§ëŠ” ìš´ëª…ì˜ ìŒì‹</p>
    </div>

    <div class="content">
        <div class="input-card">
            <label>íƒœì–´ë‚œ ë‚ ì§œ</label>
            <input type="date" id="birthDate" value="1995-06-15">
            <label>íƒœì–´ë‚œ ì‹œê°„</label>
            <select id="birthTime">
                <option value="1">ìì‹œ (00:00~)</option><option value="3">ì¶•ì‹œ (01:30~)</option>
                <option value="5">ì¸ì‹œ (03:30~)</option><option value="7">ë¬˜ì‹œ (05:30~)</option>
                <option value="9">ì§„ì‹œ (07:30~)</option><option value="11">ì‚¬ì‹œ (09:30~)</option>
                <option value="13">ì˜¤ì‹œ (11:30~)</option><option value="15">ë¯¸ì‹œ (13:30~)</option>
                <option value="17">ì‹ ì‹œ (15:30~)</option><option value="19">ìœ ì‹œ (17:30~)</option>
                <option value="21">ìˆ ì‹œ (19:30~)</option><option value="23">í•´ì‹œ (21:30~)</option>
            </select>
            <button class="btn-main" onclick="runSikgyeol()">ë‚˜ì˜ ì‹ê²° ê²°ê³¼ë³´ê¸°</button>
        </div>

        <div id="resultArea">
            <div id="captureArea">
                <h3 style="text-align: center; margin: 0;">ë‚˜ì˜ ì˜¤í–‰ ì—ë„ˆì§€ ë³´ê³ ì„œ</h3>
                <p id="userName" style="text-align:center; font-size:0.75rem; color:#999; margin-bottom:10px;"></p>
                
                <div class="chart-container">
                    <canvas id="energyChart"></canvas>
                </div>
                
                <div class="card solution">
                    <span id="lackBadge" class="badge">ë¶€ì¡±í•œ ê¸°ìš´ ë³´ì¶©</span>
                    <h2 id="resTitle" style="margin: 5px 0; font-size: 1.2rem;"></h2>
                    <p id="resDesc" style="font-size: 0.9rem; color: #555; margin-bottom: 10px;"></p>
                    <div style="background: white; padding: 12px; border-radius: 10px; border: 1px solid #e0e0e0;">
                        <small style="color: #999;">ì¶”ì²œ ì‹ì¬ë£Œ/ë©”ë‰´</small>
                        <div id="resFood" style="font-weight: bold; color: #1a1a1a; font-size: 1rem;"></div>
                    </div>
                </div>

                <div class="card avoid" id="avoidArea">
                    <span class="badge" style="background: #ff5252;">ê³¼ìœ ë¶ˆê¸‰ ì£¼ì˜</span>
                    <h3 id="avoidTitle" style="margin: 5px 0; font-size: 1rem; color: #d32f2f;"></h3>
                    <p id="avoidDesc" style="font-size: 0.85rem; color: #666;"></p>
                </div>
                <p style="text-align:center; font-size:0.6rem; color:#eee; margin-top:15px;">Â© SIKGYEOL All rights reserved.</p>
            </div>

            <div class="action-group">
                <button class="btn-save" onclick="saveAsImage()">ğŸ“· ì´ë¯¸ì§€ ì €ì¥</button>
                <button class="btn-sub" onclick="shareLink()">ğŸ”— ë§í¬ ë³µì‚¬</button>
            </div>
        </div>
    </div>
    <footer>Powered by ì‹ê²°(é£Ÿçµ)</footer>
</div>

<script>
    let myChart = null;

    const contentData = {
        'ëª©': { title: 'ìƒê¸°ë¥¼ ê¹¨ìš°ëŠ” ëª©(æœ¨) ì‹ë‹¨', desc: 'ê°„ ê¸°ìš´ì„ ë•ëŠ” ì‹ ë§›ê³¼ ì´ˆë¡ìƒ‰ ìŒì‹ì´ í•„ìš”í•©ë‹ˆë‹¤.', food: 'ë¶€ì¶”, ìƒëŸ¬ë“œ, ë§¤ì‹¤ì°¨, í‚¤ìœ„', color: '#4CAF50', avoid: 'ì§€ë‚˜ì¹˜ê²Œ ì‹  ìŒì‹, ìƒì‹' },
        'í™”': { title: 'ìˆœí™˜ì„ ë•ëŠ” í™”(ç«) ì‹ë‹¨', desc: 'ì‹¬ì¥ ê¸°ìš´ì„ ë³´ê°•í•˜ëŠ” ì“´ë§›ê³¼ ë¶‰ì€ìƒ‰ ìŒì‹ì´ ì¢‹ìŠµë‹ˆë‹¤.', food: 'í† ë§ˆí† , ìˆ˜ìˆ˜ë°¥, ìŒ‰ì‹¸ë¦„í•œ ë‚˜ë¬¼, ìëª½', color: '#F44336', avoid: 'ë§¤ìš´ ìŒì‹, ìˆ , ê³ ì¹´í˜ì¸' },
        'í† ': { title: 'ì•ˆì •ì„ ì£¼ëŠ” í† (åœŸ) ì‹ë‹¨', desc: 'ìœ„ì¥ì„ í¸ì•ˆí•˜ê²Œ í•˜ëŠ” ë‹¨ë§›ê³¼ ë…¸ë€ìƒ‰ ìŒì‹ì´ ë³´ì•½ì…ë‹ˆë‹¤.', food: 'ë‹¨í˜¸ë°• ì£½, ê³ êµ¬ë§ˆ, ê°ì, ê¿€', color: '#FFC107', avoid: 'ì§€ë‚˜ì¹˜ê²Œ ë‹¨ ìŒì‹, ë°€ê°€ë£¨' },
        'ê¸ˆ': { title: 'ë©´ì—­ì„ ë†’ì´ëŠ” ê¸ˆ(é‡‘) ì‹ë‹¨', desc: 'íë¥¼ ë§‘ê²Œ í•˜ëŠ” ë§¤ìš´ë§›ê³¼ í°ìƒ‰ ìŒì‹ì„ ì„­ì·¨í•˜ì„¸ìš”.', food: 'ë„ë¼ì§€ì¦™, ë¬´êµ­, ì–‘íŒŒ, ë§ˆëŠ˜, ë°°', color: '#9E9E9E', avoid: 'ë”±ë”±í•œ ìŒì‹, ê·¹ë‹¨ì ìœ¼ë¡œ ë§¤ìš´ ë§›' },
        'ìˆ˜': { title: 'ì •í™”í•´ì£¼ëŠ” ìˆ˜(æ°´) ì‹ë‹¨', desc: 'ì‹ ì¥ ê¸°ìš´ì„ ë•ëŠ” ì§ ë§›ê³¼ ê²€ì€ìƒ‰ ìŒì‹ì´ í•„ìš”í•©ë‹ˆë‹¤.', food: 'ë¯¸ì—­êµ­, ê²€ì€ì½© ì¡°ë¦¼, ê¹€, ë¸”ë£¨ë² ë¦¬', color: '#2196F3', avoid: 'ì§  ìŒì‹, ì°¨ê°€ìš´ ì–¼ìŒë¬¼' }
    };

    function runSikgyeol() {
        const date = document.getElementById('birthDate').value;
        const hour = document.getElementById('birthTime').value;
        if(!date) return alert("ìƒë…„ì›”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");

        // 1. ì‚¬ì£¼ ë¶„ì„
        const d = new Date(date);
        const solar = Solar.fromYmdHms(d.getFullYear(), d.getMonth()+1, d.getDate(), hour, 0, 0);
        const eightChars = solar.getLunar().getEightChar();
        const chars = [eightChars.getYearGan(), eightChars.getYearZhi(), eightChars.getMonthGan(), eightChars.getMonthZhi(), eightChars.getDayGan(), eightChars.getDayZhi(), eightChars.getTimeGan(), eightChars.getTimeZhi()];

        const counts = { 'ëª©': 0, 'í™”': 0, 'í† ': 0, 'ê¸ˆ': 0, 'ìˆ˜': 0 };
        const map = { 'ç”²':'ëª©','ä¹™':'ëª©','å¯…':'ëª©','å¯':'ëª©','ä¸™':'í™”','ä¸':'í™”','å·³':'í™”','åˆ':'í™”','æˆŠ':'í† ','å·±':'í† ','è¾°':'í† ','æˆŒ':'í† ','ä¸‘':'í† ','æœª':'í† ','åºš':'ê¸ˆ','è¾›':'ê¸ˆ','ç”³':'ê¸ˆ','é…‰':'ê¸ˆ','å£¬':'ìˆ˜','ç™¸':'ìˆ˜','äº¥':'ìˆ˜','å­':'ìˆ˜' };
        chars.forEach(c => { if(map[c]) counts[map[c]]++; });

        // 2. ê²°ê³¼ ë„ì¶œ
        const sorted = Object.entries(counts).sort((a, b) => a[1] - b[1]);
        const lack = sorted[0][0];
        const excess = sorted[sorted.length - 1][0];

        // 3. UI ì—…ë°ì´íŠ¸
        drawChart(counts);
        displayResult(lack, excess, counts[excess]);
        
        document.getElementById('userName').innerText = `${date} ë¶„ì„ ê²°ê³¼`;
        document.getElementById('resultArea').style.display = 'block';
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    function drawChart(counts) {
        const ctx = document.getElementById('energyChart').getContext('2d');
        if(myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'polarArea',
            data: {
                labels: ['ëª©', 'í™”', 'í† ', 'ê¸ˆ', 'ìˆ˜'],
                datasets: [{
                    data: [counts['ëª©'], counts['í™”'], counts['í† '], counts['ê¸ˆ'], counts['ìˆ˜']],
                    backgroundColor: ['#4CAF50aa', '#F44336aa', '#FFC107aa', '#9E9E9Eaa', '#2196F3aa'],
                    borderWidth: 0
                }]
            },
            options: { plugins: { legend: { position: 'bottom', labels: { boxWidth: 12 } } } }
        });
    }

    function displayResult(lack, excess, exCount) {
        const L = contentData[lack];
        document.getElementById('lackBadge').style.backgroundColor = L.color;
        document.getElementById('resTitle').innerText = L.title;
        document.getElementById('resDesc').innerText = L.desc;
        document.getElementById('resFood').innerText = L.food;

        const avoidSection = document.getElementById('avoidArea');
        if (exCount >= 3) {
            const E = contentData[excess];
            avoidSection.style.display = 'block';
            document.getElementById('avoidTitle').innerText = `${excess} ê¸°ìš´ì´ ë„ˆë¬´ ê°•í•©ë‹ˆë‹¤`;
            document.getElementById('avoidDesc').innerText = `${E.avoid}ì€ ì£¼ì˜í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.`;
        } else {
            avoidSection.style.display = 'none';
        }
    }

    function saveAsImage() {
        html2canvas(document.querySelector("#captureArea"), { scale: 2 }).then(canvas => {
            const link = document.createElement('a');
            link.download = `ì‹ê²°_ë³´ê³ ì„œ_${new Date().getTime()}.png`;
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    function shareLink() {
        navigator.clipboard.writeText(window.location.href).then(() => alert("ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"));
    }
</script>
</body>
</html>
