<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ì‹ê²°(é£Ÿçµ) - ë§ì¶¤ ìš´ëª… ì²˜ë°©</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;500;700&display=swap');
        :root { --paper: #f4f1ea; --ink: #2c2c2c; --wood: #5d7a66; --fire: #a64e4e; --earth: #c4a46d; --metal: #8a8a8a; --water: #4e657a; }
        body { font-family: 'Noto Serif KR', serif; background-color: #e0ddd5; margin: 0; padding: 20px; color: var(--ink); line-height: 1.7; word-break: keep-all; }
        .app-container { max-width: 450px; margin: auto; background: var(--paper); border: 1px solid #d1cdbf; box-shadow: 0 12px 50px rgba(0,0,0,0.12); }
        .header { padding: 40px 20px; text-align: center; border-bottom: 1px double #d1cdbf; }
        .header h1 { font-weight: 700; letter-spacing: 12px; margin: 0; font-size: 1.8rem; }
        .content { padding: 30px 25px; }
        .section-title { font-size: 0.95rem; font-weight: 700; margin: 25px 0 12px; border-left: 3px solid var(--ink); padding-left: 12px; }
        input, select { width: 100%; border: none; border-bottom: 1px solid #bbb; background: transparent; padding: 12px 8px; margin-bottom: 15px; font-family: inherit; font-size: 1rem; outline: none; box-sizing: border-box; }
        button { width: 100%; padding: 18px; border: 1px solid var(--ink); background: var(--ink); color: white; cursor: pointer; font-family: inherit; font-weight: 500; display: flex; justify-content: center; align-items: center; letter-spacing: 2px; margin-top: 15px; }
        .food-tag { display: inline-flex; align-items: center; justify-content: center; padding: 8px 16px; margin: 5px; background: #fff; border: 1px solid #d1cdbf; cursor: pointer; border-radius: 30px; font-size: 0.85rem; font-weight: 500; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: var(--paper); width: 85%; max-width: 380px; padding: 35px; border-radius: 2px; text-align: center; max-height: 80vh; overflow-y: auto; }
        .q-group { text-align: left; margin-bottom: 25px; }
        .q-group b { display: block; margin-bottom: 12px; font-size: 1rem; color: var(--ink); border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .q-group label { display: flex; align-items: center; margin-bottom: 10px; font-size: 0.9rem; cursor: pointer; line-height: 1.4; }
        .q-group input[type="radio"] { width: auto; margin: 0 12px 0 0; accent-color: var(--ink); flex-shrink: 0; }
        #journalCapture { display: none; width: 400px; padding: 50px; background: var(--paper); border: 2px solid var(--ink); color: var(--ink); }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h1>é£Ÿ çµ</h1>
        <p>ì‹¤ì‹œê°„ ì»¨ë””ì…˜ì„ ë°˜ì˜í•œ ìš´ëª… ì²˜ë°©</p>
    </div>

    <div class="content">
        <input type="text" id="userNameInput" placeholder="ì„±í•¨ ë˜ëŠ” í˜¸">
        
        <div class="section-title">ì¶œìƒ ë° ì²´í˜• ì§„ë‹¨</div>
        <input type="date" id="birthDate" value="1995-01-01">
        <select id="birthTime">
            <option value="0">å­ì‹œ (23:30 ~ 01:29)</option><option value="12">åˆì‹œ (11:30 ~ 13:29)</option>
            <option value="22">äº¥ì‹œ (21:30 ~ 23:29)</option>
        </select>
        <select id="bodyType">
            <option value="unknown">ì²´í˜• ë° ì»¨ë””ì…˜ ì§„ë‹¨í•˜ê¸°</option>
            <option value="íƒœìŒì¸">íƒœìŒì¸ (ì²´êµ¬ê°€ í¬ê³  ìŠµì´ ë§ìŒ)</option>
            <option value="ì†ŒìŒì¸">ì†ŒìŒì¸ (ì²´êµ¬ê°€ ì‘ê³  ëƒ‰í•¨)</option>
            <option value="ì†Œì–‘ì¸">ì†Œì–‘ì¸ (ìƒì²´ ë°œë‹¬, ì—´ì´ ë§ìŒ)</option>
        </select>

        <button onclick="checkAndAnalyze()">ì •ë°€ ë¶„ì„ ë° ì²˜ë°©</button>

        <div id="resultArea" style="display:none; margin-top:40px; border-top:2px solid var(--ink); padding-top:30px;">
            <div id="dailyInfo" style="text-align:center; font-size:0.85rem; color:#888; margin-bottom:20px;"></div>
            
            <div class="section-title">ë©”ë‰´ ê¶í•© ì§„ë‹¨</div>
            <div style="display: flex; gap: 8px;">
                <input type="text" id="userFoodInput" placeholder="ë©”ë‰´ ì…ë ¥ (ì˜ˆ: ë§ˆë¼íƒ•)" style="margin-bottom:0;">
                <button onclick="checkFoodHarmony()" style="width: 85px; padding: 12px; margin-top:0; font-size:0.9rem;">ì§„ë‹¨</button>
            </div>
            <div id="harmonyResult" style="margin: 15px 0; font-size: 0.85rem; font-weight: 700; text-align:center;"></div>

            <div style="height:260px; margin:25px 0;"><canvas id="energyChart"></canvas></div>
            
            <div id="foodBox" style="background: rgba(0,0,0,0.02); padding: 25px; border-radius: 2px; margin: 25px 0; border: 1px solid rgba(0,0,0,0.05);">
                <div id="resTitle" style="font-size:1.3rem; font-weight:700; color:var(--fire); margin-bottom:12px;"></div>
                <div id="resDesc" style="font-size:0.9rem; color:#666; margin-bottom:18px;"></div>
                <div id="resFoodList"></div>
            </div>
            <button onclick="saveJournal()" style="background:#8e735b; border:none;">ğŸ“œ ì˜¤ëŠ˜ì˜ ì‹ê²° ì¼ê¸° ì €ì¥</button>
        </div>
    </div>
</div>

<div id="diagModal" class="modal">
    <div class="modal-content">
        <h3>ì •ë°€ ì»¨ë””ì…˜ ì§„ë‹¨</h3>
        <div class="q-group">
            <b>1. í˜„ì¬ì˜ ê³µë³µ ë° ì‹ì‚¬ ì‹œì ì€?</b>
            <label><input type="radio" name="qTime" value="ê³µë³µ"> ê³µë³µ ìƒíƒœ (ì†ì´ ë¹„ì–´ìˆìŒ)</label>
            <label><input type="radio" name="qTime" value="ì•„ì¹¨"> ì•„ì¹¨ ì‹ì‚¬ (í™œë ¥ì´ í•„ìš”í•¨)</label>
            <label><input type="radio" name="qTime" value="ì ì‹¬"> ì ì‹¬ ì‹ì‚¬ (ì—ë„ˆì§€ ì§‘ì¤‘ í•„ìš”)</label>
            <label><input type="radio" name="qTime" value="ì €ë…"> ì €ë… ì‹ì‚¬ (íœ´ì‹ê³¼ ì§„ì • í•„ìš”)</label>
        </div>
        <div class="q-group">
            <b>2. ìŠ¤íŠ¸ë ˆìŠ¤ ë° ì‹¬ë¦¬ ìƒíƒœëŠ”?</b>
            <label><input type="radio" name="qStress" value="high"> ìŠ¤íŠ¸ë ˆìŠ¤ ë†’ìŒ (ê°€ìŠ´ì´ ë‹µë‹µí•¨)</label>
            <label><input type="radio" name="qStress" value="low"> í‰ì˜¨í•¨ (ì•ˆì •ëœ ìƒíƒœ)</label>
        </div>
        <div class="q-group">
            <b>3. ì–´ì œ ìˆ˜ë©´ì˜ ì§ˆì€ ì–´ë• ë‚˜ìš”?</b>
            <label><input type="radio" name="qSleep" value="bad"> ë¶€ì¡±í•¨ (ëª¸ì´ ë¬´ê²ê³  í”¼ê³¤í•¨)</label>
            <label><input type="radio" name="qSleep" value="good"> ì¶©ë¶„í•¨ (ê°œìš´í•œ ìƒíƒœ)</label>
        </div>
        <button onclick="finishDiag()">ì§„ë‹¨ ì™„ë£Œ</button>
    </div>
</div>

<script>
    let chart=null, baseCounts={}, currentLack='';
    const data = {
        'ëª©': { t:'æœ¨: í‘¸ë¥¸ ìƒê¸°', desc:'ê°„ ê¸°ìš´ì„ ë•ê³  ëª¸ì„ ê¹¨ìš°ëŠ” ì‹±ê·¸ëŸ¬ìš´ ì²˜ë°©ì…ë‹ˆë‹¤.', c:'#5d7a66' },
        'í™”': { t:'ç«: ë¶‰ì€ ì˜¨ê¸°', desc:'ì‹¬ì¥ ìˆœí™˜ì„ ë•ê³  ì—´ì •ì„ ì±„ìš°ëŠ” ì²˜ë°©ì…ë‹ˆë‹¤.', c:'#a64e4e' },
        'í† ': { t:'åœŸ: í™©ìƒ‰ ì¤‘ì‹¬', desc:'ë¹„ìœ„ë¥¼ ë³´ê°•í•˜ì—¬ ê¸°ë ¥ì„ ì±„ìš°ëŠ” ì²˜ë°©ì…ë‹ˆë‹¤.', c:'#c4a46d' },
        'ê¸ˆ': { t:'é‡‘: ë°±ìƒ‰ ê²°ì‹¤', desc:'í ê¸°ìš´ì„ ë‹¤ì§€ê³  ë©´ì—­ë ¥ì„ ë†’ì´ëŠ” ì²˜ë°©ì…ë‹ˆë‹¤.', c:'#8a8a8a' },
        'ìˆ˜': { t:'æ°´: ê²€ì€ ì§€í˜œ', desc:'ì‹ ì¥ ì›ê¸°ë¥¼ ì±„ìš°ê³  ì—´ì„ ì‹íˆëŠ” ì²˜ë°©ì…ë‹ˆë‹¤.', c:'#4e657a' }
    };

    function checkAndAnalyze() {
        document.getElementById('diagModal').style.display = 'flex';
    }

    function finishDiag() {
        const qTime = document.querySelector('input[name="qTime"]:checked');
        const qStress = document.querySelector('input[name="qStress"]:checked');
        const qSleep = document.querySelector('input[name="qSleep"]:checked');
        
        if(!qTime || !qStress || !qSleep) return alert("ëª¨ë“  í•­ëª©ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.");
        
        document.getElementById('diagModal').style.display = 'none';
        analyze(qTime.value, qStress.value, qSleep.value);
    }

    function analyze(time, stress, sleep) {
        const b = document.getElementById('birthDate').value;
        const solar = Solar.fromYmdHms(new Date(b).getFullYear(), new Date(b).getMonth()+1, new Date(b).getDate(), parseInt(document.getElementById('birthTime').value), 0, 0);
        const tLunar = Solar.fromDate(new Date()).getLunar();
        const map = {'ç”²':'ëª©','ä¹™':'ëª©','å¯…':'ëª©','å¯':'ëª©','ä¸™':'í™”','ä¸':'í™”','å·³':'í™”','åˆ':'í™”','æˆŠ':'í† ','å·±':'í† ','è¾°':'í† ','æˆŒ':'í† ','ä¸‘':'í† ','æœª':'í† ','åºš':'ê¸ˆ','è¾›':'ê¸ˆ','ç”³':'ê¸ˆ','é…‰':'ê¸ˆ','å£¬':'ìˆ˜','ç™¸':'ìˆ˜','äº¥':'ìˆ˜','å­':'ìˆ˜'};
        
        baseCounts = {'ëª©':0,'í™”':0,'í† ':0,'ê¸ˆ':0,'ìˆ˜':0};
        const my8 = solar.getLunar().getEightChar();
        [my8.getYearGan(),my8.getYearZhi(),my8.getMonthGan(),my8.getMonthZhi(),my8.getDayGan(),my8.getDayZhi(),my8.getTimeGan(),my8.getTimeZhi(),tLunar.getDayGan(),tLunar.getDayZhi()].forEach(c => { if(map[c]) baseCounts[map[c]]++; });
        
        currentLack = Object.entries(baseCounts).sort((a,b) => a[1]-b[1])[0][0];

        // ì‹¤ì‹œê°„ ì»¨ë””ì…˜ì— ë”°ë¥¸ ì¶”ê°€ ì¡°ì–¸ ìƒì„±
        let advice = "";
        if(stress === 'high') advice += "ìŠ¤íŠ¸ë ˆìŠ¤ë¡œ ì¸í•´ í™”(ç«)ê¸°ê°€ ìƒìŠ¹í–ˆìœ¼ë‹ˆ ë¶€ë“œëŸ¬ìš´ ë§›ìœ¼ë¡œ ê¸°ìš´ì„ ë‚´ë¦¬ì„¸ìš”. ";
        if(sleep === 'bad') advice += "ìˆ˜ë©´ ë¶€ì¡±ìœ¼ë¡œ ì‹ ì¥(æ°´) ê¸°ìš´ì´ ê³ ê°ˆë˜ì—ˆìœ¼ë‹ˆ ë³´í˜ˆ ì‹ë‹¨ì´ í•„ìˆ˜ì…ë‹ˆë‹¤. ";
        if(time === 'ê³µë³µ') advice += "í˜„ì¬ ê³µë³µì´ë¯€ë¡œ ë¹„ìœ„(åœŸ)ë¥¼ ìê·¹í•˜ì§€ ì•ŠëŠ” ë‹´ë°±í•œ ì‹œì‘ì´ ì¢‹ìŠµë‹ˆë‹¤.";

        document.getElementById('dailyInfo').innerText = `${time} | ìŠ¤íŠ¸ë ˆìŠ¤ ${stress === 'high' ? 'ë†’ìŒ' : 'ë³´í†µ'} | ${tLunar.getDayInGanZhi()}ì¼`;
        document.getElementById('resTitle').innerText = data[currentLack].t;
        document.getElementById('resDesc').innerHTML = `<b>[ì‹¤ì‹œê°„ ë¶„ì„]</b> ${advice}<br><br>${data[currentLack].desc}`;
        
        const foods = ['ê·¸ë¦­ ìš”ê±°íŠ¸', 'ë§ˆë¼íƒ•', 'ë“¤ê¸°ë¦„ ë§‰êµ­ìˆ˜', 'íŠ¸ëŸ¬í”Œ ë¦¬ì¡°ë˜', 'í‰ì–‘ëƒ‰ë©´']; // ì˜ˆì‹œ ë°ì´í„°
        document.getElementById('resFoodList').innerHTML = foods.map(f => `<span class="food-tag">#${f}</span>`).join('');
        
        renderChart(baseCounts);
        document.getElementById('resultArea').style.display = 'block';
    }

    function renderChart(c) {
        const ctx = document.getElementById('energyChart').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['ëª©','í™”','í† ','ê¸ˆ','ìˆ˜'],
                datasets: [{ data: Object.values(c), backgroundColor: 'rgba(0,0,0,0.05)', borderColor: '#2c2c2c', borderWidth: 1.5 }]
            },
            options: { scales: { r: { beginAtZero: true, max: 8, ticks: { display: false } } }, plugins: { legend: { display: false } } }
        });
    }

    function saveJournal() {
        alert("ì¼ê¸°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (ë‹¤ìš´ë¡œë“œ ë¡œì§ ìƒëµ)");
    }
</script>
</body>
</html>
