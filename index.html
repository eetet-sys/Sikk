<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ì‹ê²°(é£Ÿçµ) - ì™„ì „ì²´ ë§ˆìŠ¤í„° ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&family=Song+Myung&display=swap');
        
        :root { --paper: #fdfcf8; --ink: #1a1a1a; --wood: #4A6741; --fire: #A24841; --earth: #C29A5B; --metal: #7D7D7D; --water: #3E5266; }
        body { font-family: 'Noto Serif KR', serif; background-color: #dcd9d0; margin: 0; padding: 15px; color: var(--ink); line-height: 1.6; -webkit-tap-highlight-color: transparent; }
        
        .app-container { max-width: 420px; margin: auto; background: var(--paper); border: 1px solid #c9c4b9; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-radius: 12px; overflow: hidden; transition: background 0.5s ease; }
        .header { padding: 45px 20px; text-align: center; border-bottom: 1px double #d1cdbf; background: #f9f7f0; }
        .header h1 { font-family: 'Song Myung', serif; font-size: 2.8rem; margin: 0; letter-spacing: 15px; text-indent: 15px; }
        
        .content { padding: 30px 25px; }
        .section-title { font-size: 0.85rem; font-weight: 700; margin: 25px 0 12px; border-left: 3px solid var(--ink); padding-left: 10px; color: #444; }
        
        input, select { width: 100%; border: none; border-bottom: 1px solid #d1cdbf; background: transparent; padding: 12px 5px; margin-bottom: 18px; font-family: inherit; font-size: 1rem; outline: none; box-sizing: border-box; }
        button.main-btn { width: 100%; padding: 18px; background: var(--ink); color: #fff; border: none; font-weight: 700; cursor: pointer; border-radius: 4px; transition: 0.3s; }

        /* [í•µì‹¬] ì„¤ë¬¸ ëª¨ë‹¬ - ì§ˆë¬¸ ì•ˆë³´ì„ & ì•ˆë„˜ì–´ê° í•´ê²° */
        #diagModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9999; justify-content:center; align-items:center; padding:20px; box-sizing:border-box; }
        .survey-card { background:#fff; padding:30px; border-radius:15px; width:100%; max-width:360px; min-height: 350px; }
        
        /* ì§ˆë¬¸ì´ ê²¹ì¹˜ì§€ ì•Šê³  ìˆœì„œëŒ€ë¡œ í™•ì‹¤íˆ ë‚˜íƒ€ë‚˜ë„ë¡ ê°•ì œ ì„¤ì • */
        .survey-item { display: none !important; }
        .survey-item.active { display: block !important; animation: fadeIn 0.3s forwards; }
        
        .survey-question { font-weight: bold; font-size: 1.1rem; margin-bottom: 25px; color: #333; line-height: 1.4; }
        .opt-btn { width: 100%; padding: 16px; margin-bottom: 12px; border: 1px solid #ddd; background: #fff; border-radius: 8px; text-align: left; font-family: inherit; cursor: pointer; font-size: 0.95rem; }
        .opt-btn:active { background: #f9f7f0; transform: scale(0.98); }

        /* ì²˜ë°©ì „ ì¹´ë“œ ë¹„ì£¼ì–¼ */
        #prescriptionCard { display: none; background: var(--paper); padding: 35px 25px; border: 12px double #d1cdbf; margin: 10px; text-align: center; position: relative; }
        .badge { display: inline-block; padding: 4px 12px; background: rgba(0,0,0,0.05); border-radius: 20px; font-size: 0.75rem; margin-bottom: 15px; font-weight: bold; }
        .body-icon { font-size: 3.5rem; margin-bottom: 10px; display: block; }
        .advice-box { font-size: 0.85rem; background: #f9f7f0; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: left; border: 1px solid #eee; }
        .tag-box { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin: 15px 0; }
        .tag { padding: 5px 12px; border: 1px solid #d1cdbf; font-size: 0.8rem; border-radius: 4px; background: #fff; }
        .warning-box { font-size: 0.8rem; color: #a24841; background: #fdf2f2; padding: 12px; border-radius: 8px; text-align: left; border-left: 4px solid #a24841; margin-top: 10px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
<div class="app-container" id="mainApp">
    <div id="inputForm">
        <div class="header"><h1>é£Ÿ çµ</h1><p>ì •ë°€ ì‹œì°¨Â·ë‚ ì”¨Â·ì²´ì§ˆ ì™„ì „ì²´</p></div>
        <div class="content">
            <input type="text" id="userName" placeholder="ì„±í•¨(è™Ÿ) ì…ë ¥">
            <div class="section-title">ì¶œìƒ ì •ë³´</div>
            <input type="date" id="birthDate" value="1995-01-01">
            <select id="birthTime">
                <option value="0">å­ì‹œ (23:30~01:29)</option><option value="2">ä¸‘ì‹œ (01:30~03:29)</option>
                <option value="12" selected>åˆì‹œ (11:30~13:29)</option><option value="22">äº¥ì‹œ (21:30~23:29)</option>
            </select>
            <div class="section-title">ì¶œìƒì§€</div>
            <select id="birthCity"><option value="127.0" selected>ì„œìš¸, ê²½ê¸°, ì „ì£¼</option><option value="129.0">ë¶€ì‚°, ìš¸ì‚°, í¬í•­</option></select>
            <button class="main-btn" onclick="openSurvey()">ì§„ë‹¨ ë° ë¶„ì„ ì‹œì‘</button>
        </div>
    </div>

    <div id="prescriptionCard">
        <div id="resWeather" class="badge"></div>
        <div id="cardMeta" style="font-size: 0.65rem; color: #999; margin-bottom: 10px; display: flex; justify-content: space-between;"><span id="resName"></span><span id="resToday"></span></div>
        <span id="resIcon" class="body-icon"></span>
        <div id="resBodyType" style="font-size: 0.85rem; font-weight: 700; letter-spacing: 2px;"></div>
        <h2 id="resTitle" style="font-family: 'Song Myung', serif; font-size: 2.2rem; margin: 10px 0;"></h2>
        <canvas id="energyChart" style="max-height: 180px; margin: 15px 0;"></canvas>
        <div id="resAdvice" class="advice-box"></div>
        <div class="section-title">ì¶”ì²œ ì‹ì¬ë£Œ (å‰)</div><div class="tag-box" id="goodFoods"></div>
        <div class="section-title">ì£¼ì˜í•  ì‹í’ˆ (å‡¶)</div><div class="tag-box" id="badFoods"></div>
        <div id="resLife" class="advice-box" style="border-left: 4px solid var(--wood);"></div>
        <div id="resWarning" class="warning-box"></div>
    </div>
</div>

<div id="diagModal">
    <div class="survey-card">
        <h3 id="surveyTitle" style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:15px; font-family:'Song Myung';">ì²´ì§ˆ ì§„ë‹¨ (1/4)</h3>
        <div id="surveyItems">
            <div class="survey-item active" id="st1">
                <p class="survey-question">1. í‰ì†Œ ì²´í˜•ê³¼ ê³¨ê²©ì€ ì–´ë– ì‹ ê°€ìš”?</p>
                <button class="opt-btn" onclick="handleNext(1, 'íƒœìŒì¸')">ê³¨ê²©ì´ í¬ê³  ë¬´ê²Œê°ì´ ìˆìŒ</button>
                <button class="opt-btn" onclick="handleNext(1, 'ì†ŒìŒì¸')">í•˜ì²´ê°€ ë°œë‹¬í•˜ê³  ê°€ëƒ˜í”ˆ í¸</button>
                <button class="opt-btn" onclick="handleNext(1, 'ì†Œì–‘ì¸')">ìƒì²´ê°€ ë°œë‹¬í•˜ê³  ê±¸ìŒì´ ë¹ ë¦„</button>
            </div>
            <div class="survey-item" id="st2">
                <p class="survey-question">2. ì„±ê²©ì´ë‚˜ ì¼ ì²˜ë¦¬ ë°©ì‹ì€?</p>
                <button class="opt-btn" onclick="handleNext(2, 'íƒœìŒì¸')">ëŠê¸‹í•˜ê³  ì°¸ì„ì„±ì´ ë§ìŒ</button>
                <button class="opt-btn" onclick="handleNext(2, 'ì†ŒìŒì¸')">ì„¸ì‹¬í•˜ê³  ê¼¼ê¼¼í•˜ë©° ë‚´ì„±ì ì„</button>
                <button class="opt-btn" onclick="handleNext(2, 'ì†Œì–‘ì¸')">íŒë‹¨ì´ ë¹ ë¥´ê³  ì†”ì§ë‹´ë°±í•¨</button>
            </div>
            <div class="survey-item" id="st3">
                <p class="survey-question">3. ì†Œí™” ìƒíƒœì™€ ì°¬ ìŒì‹ ë°˜ì‘ì€?</p>
                <button class="opt-btn" onclick="handleNext(3, 'ì†ŒìŒì¸')">ì°¬ ê²ƒì„ ë¨¹ìœ¼ë©´ ë°°ê°€ ìì£¼ ì•„í””</button>
                <button class="opt-btn" onclick="handleNext(3, 'ì†Œì–‘ì¸')">ì‹œì›í•œ ìŒì‹ì„ ì¦ê¹€ (ëƒ‰ë©´ ë“±)</button>
                <button class="opt-btn" onclick="handleNext(3, 'íƒœìŒì¸')">ë¬´ì—‡ì´ë“  ì˜ ë¨¹ê³  ì†Œí™”ë ¥ì´ ì¢‹ìŒ</button>
            </div>
            <div class="survey-item" id="st4">
                <p class="survey-question">4. ì»¨ë””ì…˜ì´ ê°€ì¥ ì¢‹ì„ ë•Œ ëŠë‚Œ?</p>
                <button class="opt-btn" onclick="handleNext(4, 'íƒœìŒì¸')">ë•€ì„ ì‹œì›í•˜ê²Œ í˜ë¦¬ê³  ë‚¬ì„ ë•Œ</button>
                <button class="opt-btn" onclick="handleNext(4, 'ì†ŒìŒì¸')">ìŒì‹ ì†Œí™”ê°€ ì•„ì£¼ í¸ì•ˆí•  ë•Œ</button>
                <button class="opt-btn" onclick="handleNext(4, 'ì†Œì–‘ì¸')">ë°°ë³€ í™œë™ì´ ë§¤ë„ëŸ½ê³  ì‹œì›í•  ë•Œ</button>
            </div>
        </div>
    </div>
</div>
<script>
    let answers = {}; let chart = null;
    const elementMap = {'ç”²':'ëª©','ä¹™':'ëª©','å¯…':'ëª©','å¯':'ëª©','ä¸™':'í™”','ä¸':'í™”','å·³':'í™”','åˆ':'í™”','æˆŠ':'í† ','å·±':'í† ','è¾°':'í† ','æˆŒ':'í† ','ä¸‘':'í† ','æœª':'í† ','åºš':'ê¸ˆ','è¾›':'ê¸ˆ','ç”³':'ê¸ˆ','é…‰':'ê¸ˆ','å£¬':'ìˆ˜','ç™¸':'ìˆ˜','äº¥':'ìˆ˜','å­':'ìˆ˜'};

    // [ë¬´ì‚­ì œ] ì „ì²´ ë°ì´í„°ë² ì´ìŠ¤
    const fullDB = {
        food: {
            'íƒœìŒì¸': { good: ['ì†Œê³ ê¸°','ìš°ìœ ','ë¬´','ì—°ê·¼','ê³ êµ¬ë§ˆ','ë°°','ì½©','ë“¤ê¹¨','ìœ¨ë¬´','ë„ë¼ì§€','ë”ë•','ë§ˆ','ë°¤','í˜¸ë‘','ë¯¸ì—­'], bad: ['ë‹­ê³ ê¸°','ì¡°ê°œë¥˜','ìƒˆìš°','ë©”ë°€','ë°°ì¶”','ì»¤í”¼','ìˆ ','ì„¤íƒ•'] },
            'ì†ŒìŒì¸': { good: ['ë‹­ê³ ê¸°','ì¸ì‚¼','ëŒ€ì¶”','ìƒê°•','ì‚¬ê³¼','ì°¹ìŒ€','ë¯¸ê¾¸ë¼ì§€','ë¶€ì¶”','ì‹œê¸ˆì¹˜','ì¹´ë ˆ','ê°ì','ì–‘ë°°ì¶”','ë©¸ì¹˜','í† ë§ˆí† '], bad: ['ë¼ì§€ê³ ê¸°','ìˆ˜ë°•','ì°¸ì™¸','ë³´ë¦¬','ë©”ë°€','ë°€ê°€ë£¨','ëƒ‰ë©´','ë¹™ê³¼ë¥˜'] },
            'ì†Œì–‘ì¸': { good: ['ë¼ì§€ê³ ê¸°','ì˜¤ë¦¬ê³ ê¸°','ì˜¤ì´','ìˆ˜ë°•','ì „ë³µ','êµ´','ë³´ë¦¬','ì°¸ì™¸','ë”¸ê¸°','ë…¹ì°¨','ë°”ë‚˜ë‚˜','í•´ì‚¼','ë©”ë°€'], bad: ['ë‹­ê³ ê¸°','ì¸ì‚¼','ìƒê°•','ê³ ì¶”','ê¿€','ì‚¬ê³¼','ê·¤','ì˜¤ë Œì§€','í›„ì¶”'] }
        },
        lifestyle: {
            'íƒœìŒì¸': "ë•€ì´ í ë»‘ ë‚˜ëŠ” ì¡°ê¹…ì´ë‚˜ ë“±ì‚°ì´ í•„ìˆ˜ì…ë‹ˆë‹¤. ì •ì²´ë˜ê¸° ì‰¬ìš°ë‹ˆ ì‹í›„ ê°€ë²¼ìš´ ì‚°ì±…ì„ ìƒí™œí™”í•˜ì„¸ìš”. ìŠµ(æ¿•)ì„ ì¡°ì‹¬í•˜ì‹­ì‹œì˜¤.",
            'ì†ŒìŒì¸': "ì²´ì˜¨ ìœ ì§€ì— í˜ì“°ê³  ê°€ë²¼ìš´ ìš”ê°€ë‚˜ ì‚°ì±…ì´ ì í•©í•©ë‹ˆë‹¤. ë•€ì„ ë„ˆë¬´ ë§ì´ ë‚´ì§€ ë§ˆì‹­ì‹œì˜¤. í•­ìƒ ë”°ëœ»í•˜ê²Œ ë“œì„¸ìš”.",
            'ì†Œì–‘ì¸': "ìŠ¤ì¿¼íŠ¸ ë“± í•˜ì²´ ìš´ë™ìœ¼ë¡œ í™”(ç«)ë¥¼ ê°€ë¼ì•‰íˆëŠ” ê²ƒì´ ë³´ì•½ì…ë‹ˆë‹¤. ëª…ìƒìœ¼ë¡œ ë§ˆìŒì„ ë‹¤ìŠ¤ë¦¬ê³  ë‹´ë°±í•˜ê²Œ ë“œì„¸ìš”."
        },
        hansi: {
            'ëª©': { name: 'æœ¨ (ì²­ëŸ‰í•œ ìƒê¸°)', color: '#4A6741', foods: ['ëƒ‰ì´', 'ë¶€ì¶”', 'ë¯¸ë‚˜ë¦¬', 'ë§¤ì‹¤'] },
            'í™”': { name: 'ç« (ë”°ëœ»í•œ ì—ë„ˆì§€)', color: '#A24841', foods: ['ìœ¡ê°œì¥', 'ì·¨ë‚˜ë¬¼', 'ìëª½', 'ìˆ˜ìˆ˜'] },
            'í† ': { name: 'åœŸ (ì•ˆì •ì˜ ì¤‘ì‹¬)', color: '#C29A5B', foods: ['ë‹¨í˜¸ë°•', 'ê³ êµ¬ë§ˆ', 'ê°ì', 'ê¿€'] },
            'ê¸ˆ': { name: 'é‡‘ (ë‹¨ë‹¨í•œ ê²°ì‹¤)', color: '#7D7D7D', foods: ['ë‹­ê³ ê¸°', 'ë¬´êµ­', 'ë§ˆëŠ˜', 'ë°°'] },
            'ìˆ˜': { name: 'æ°´ (ê¹Šì€ íœ´ì‹)', color: '#3E5266', foods: ['ë¯¸ì—­', 'ê²€ì€ì½©', 'ê¹€', 'ë¸”ë£¨ë² ë¦¬'] }
        }
    };

    function openSurvey() { document.getElementById('diagModal').style.display='flex'; }

    // [í•´ê²°] ì²´í¬ë¦¬ìŠ¤íŠ¸ ì´ë™ ì˜¤ë¥˜ í•´ê²° ë¡œì§
    function handleNext(step, val) {
        answers[step] = val;
        if(step < 4) {
            // ëª¨ë“  ì•„ì´í…œ ìˆ¨ê¸°ê³  ë‹¤ìŒ ì•„ì´í…œë§Œ í‘œì‹œ
            document.querySelectorAll('.survey-item').forEach(el => el.classList.remove('active'));
            document.getElementById('st' + (step + 1)).classList.add('active');
            document.getElementById('surveyTitle').innerText = `ì²´ì§ˆ ì§„ë‹¨ (${step + 1}/4)`;
        } else {
            // ë§ˆì§€ë§‰ ë‹¨ê³„ ì™„ë£Œ ì‹œ ëª¨ë‹¬ ë‹«ê³  ë¶„ì„ ì‹œì‘
            document.getElementById('diagModal').style.display = 'none';
            setTimeout(startAnalysis, 200);
        }
    }

    function startAnalysis() {
        const name = document.getElementById('userName').value || 'ìµëª…';
        let stats = {'íƒœìŒì¸':0, 'ì†ŒìŒì¸':0, 'ì†Œì–‘ì¸':0};
        Object.values(answers).forEach(v => stats[v]++);
        const bodyType = Object.keys(stats).reduce((a, b) => stats[a] >= stats[b] ? a : b);

        const solar = Solar.fromDate(new Date());
        const term = solar.getTerm();
        const cityLng = parseFloat(document.getElementById('birthCity').value);
        const longDiff = (135.0 - cityLng) * 4;
        const bDate = new Date(document.getElementById('birthDate').value);
        const correctedDate = new Date(bDate.getTime() + (parseInt(document.getElementById('birthTime').value) * 60 - longDiff) * 60000);
        const eightChar = Solar.fromDate(correctedDate).getLunar().getEightChar();

        let eCounts = {'ëª©':0,'í™”':0,'í† ':0,'ê¸ˆ':0,'ìˆ˜':0};
        [eightChar.getYearGan(), eightChar.getMonthZhi(), eightChar.getDayGan(), eightChar.getTimeZhi()].forEach(c => { if(elementMap[c]) eCounts[elementMap[c]]++; });
        const lack = Object.entries(eCounts).sort((a,b)=>a[1]-b[1])[0][0];

        // UI ì ìš©
        const visual = { 'íƒœìŒì¸': { icon: 'ğŸŒ³', color: '#f4f9f4' }, 'ì†ŒìŒì¸': { icon: 'â„ï¸', color: '#f4f7f9' }, 'ì†Œì–‘ì¸': { icon: 'ğŸ”¥', color: '#f9f4f4' } };
        document.getElementById('mainApp').style.backgroundColor = visual[bodyType].color;
        document.getElementById('resWeather').innerText = `ğŸŒ¡ï¸ 2026.02.04 ì„œìš¸: -2.0Â°C (${term})`;
        document.getElementById('resName').innerText = `${name} ë‹˜`;
        document.getElementById('resToday').innerText = solar.toYmd();
        document.getElementById('resIcon').innerText = visual[bodyType].icon;
        document.getElementById('resBodyType').innerText = `[ ì •ë°€ ì²´ì§ˆ ì§„ë‹¨: ${bodyType} ]`;
        document.getElementById('resTitle').innerText = fullDB.hansi[lack].name;
        document.getElementById('resTitle').style.color = fullDB.hansi[lack].color;
        document.getElementById('resAdvice').innerHTML = `<strong>âœ¨ ${term} ì ˆê¸° ì²˜ë°©:</strong> ì…ì¶˜ì—ëŠ” ${bodyType} ë‹˜ê»˜ ìˆœí™˜ì„ ë•ëŠ” <strong>ì œì²  ë‚˜ë¬¼</strong>ê³¼ <strong>ìƒê°•ëŒ€ì¶”ì°¨</strong>ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.`;
        document.getElementById('goodFoods').innerHTML = fullDB.food[bodyType].good.map(f => `<span class="tag">#${f}</span>`).join('');
        document.getElementById('badFoods').innerHTML = fullDB.food[bodyType].bad.map(f => `<span class="tag">#${f}</span>`).join('');
        document.getElementById('resLife').innerHTML = `ğŸƒ <strong>ì–‘ìƒ:</strong> ${fullDB.lifestyle[bodyType]}`;
        document.getElementById('resWarning').innerText = `âš ï¸ ì£¼ì˜: ${bodyType === 'ì†ŒìŒì¸' ? 'ëƒ‰ì¦ ì¡°ì‹¬' : bodyType === 'ì†Œì–‘ì¸' ? 'ì—´ê¸° ì¡°ì‹¬' : 'ê³¼ì‹ ë° ì •ì²´ ì¡°ì‹¬'}`;

        renderChart(Object.values(eCounts), fullDB.hansi[lack].color);
        document.getElementById('inputForm').style.display = 'none';
        document.getElementById('prescriptionCard').style.display = 'block';
    }

    function renderChart(data, col) {
        const ctx = document.getElementById('energyChart').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, {
            type: 'radar',
            data: { labels: ['ëª©','í™”','í† ','ê¸ˆ','ìˆ˜'], datasets: [{ data: data, backgroundColor: col+'33', borderColor: col, borderWidth: 2 }] },
            options: { scales: { r: { min: 0, ticks: { display: false } } }, plugins: { legend: { display: false } } }
        });
    }

    function saveAsImage() {
        html2canvas(document.getElementById('prescriptionCard')).then(canvas => {
            const link = document.createElement('a');
            link.download = `ì‹ê²°_ì²˜ë°©ì „.png`;
            link.href = canvas.toDataURL();
            link.click();
        });
    }
</script>
</body>
</html>
