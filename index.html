<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ì‹ê²°(é£Ÿçµ) - ì •ë°€ ìš´ëª… ì‹ë‹¨</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;500;700&display=swap');

        :root {
            --paper: #f4f1ea; --ink: #2c2c2c; --wood: #5d7a66; --fire: #a64e4e; --earth: #c4a46d; --metal: #8a8a8a; --water: #4e657a;
        }

        body {
            font-family: 'Noto Serif KR', serif; background-color: #e0ddd5; margin: 0; padding: 20px;
            color: var(--ink); line-height: 1.7; word-break: keep-all;
        }

        .app-container {
            max-width: 450px; margin: auto; background: var(--paper); border: 1px solid #d1cdbf;
            box-shadow: 0 12px 50px rgba(0,0,0,0.12); border-radius: 2px;
        }

        .header { padding: 50px 20px; text-align: center; border-bottom: 1px double #d1cdbf; }
        .header h1 { font-weight: 700; letter-spacing: 12px; margin: 0; font-size: 1.8rem; }
        .header p { font-size: 0.85rem; color: #777; margin-top: 10px; font-weight: 300; }

        .content { padding: 30px 25px; }

        /* ì…ë ¥ ë° ì„ íƒ ì„¹ì…˜ */
        .section-title { font-size: 0.95rem; font-weight: 700; margin: 30px 0 15px; border-left: 3px solid var(--ink); padding-left: 12px; }
        
        input, select {
            width: 100%; border: none; border-bottom: 1px solid #bbb; background: transparent;
            padding: 14px 8px; margin-bottom: 20px; font-family: inherit; font-size: 1rem;
            outline: none; box-sizing: border-box; transition: border-color 0.3s;
        }
        input:focus { border-bottom: 1px solid var(--ink); }

        /* ì„±ë³„ ì„ íƒ ì˜ì—­ ë””ìì¸ */
        .gender-container { display: flex; gap: 20px; margin-bottom: 25px; padding: 5px 8px; }
        .gender-container label { display: flex; align-items: center; cursor: pointer; font-size: 1rem; font-weight: 500; }
        .gender-container input[type="radio"] { width: auto; margin-right: 10px; margin-bottom: 0; accent-color: var(--ink); }

        /* ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ (ì¤‘ì•™ ì •ë ¬ ìµœì í™”) */
        button {
            width: 100%; padding: 18px; border: 1px solid var(--ink); background: var(--ink);
            color: white; cursor: pointer; font-family: inherit; font-weight: 500; font-size: 1rem;
            display: flex; justify-content: center; align-items: center; letter-spacing: 2px;
            transition: all 0.3s; margin-top: 15px; border-radius: 0;
        }
        button:active { transform: scale(0.98); opacity: 0.9; }

        /* ê²°ê³¼ ë¶„ì„ ì„¹ì…˜ */
        #resultArea { display: none; margin-top: 45px; border-top: 2px solid var(--ink); padding-top: 35px; }
        
        .food-tag {
            display: inline-flex; align-items: center; justify-content: center;
            padding: 8px 16px; margin: 5px; background: #fff; border: 1px solid #d1cdbf;
            cursor: pointer; border-radius: 30px; font-size: 0.85rem; font-weight: 500;
            transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }

        .food-info { background: rgba(0,0,0,0.02); padding: 25px; border-radius: 2px; margin: 25px 0; border: 1px solid rgba(0,0,0,0.05); }

        .diary-btns { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin: 25px 0; }
        .diary-btns button { padding: 12px 0; font-size: 0.75rem; margin-top: 0; font-weight: 700; letter-spacing: 0; }

        /* ëª¨ë‹¬ ë””ìì¸ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: var(--paper); width: 85%; max-width: 350px; padding: 35px; border-radius: 2px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }

        #journalCapture { display: none; width: 400px; padding: 50px; background: var(--paper); border: 2px solid var(--ink); color: var(--ink); }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h1>é£Ÿ çµ</h1>
        <p>ì˜¤ëŠ˜ì˜ ìš´ëª…ì„ ë§›ìˆê²Œ ì²˜ë°©í•˜ë‹¤</p>
    </div>

    <div class="content">
        <div class="section-title">ê¸°ë³¸ ì •ë³´</div>
        <input type="text" id="userNameInput" placeholder="ì„±í•¨ (ë˜ëŠ” í˜¸)">
        <div class="gender-container">
            <label><input type="radio" name="gender" value="ë‚¨" checked> ë‚¨ì„±</label>
            <label><input type="radio" name="gender" value="ì—¬"> ì—¬ì„±</label>
        </div>
        
        <div class="section-title">ì¶œìƒ ì •ë³´</div>
        <input type="date" id="birthDate" value="1995-01-01">
        <select id="birthCity">
            <option value="127.0">ì„œìš¸/ê²½ê¸° (í‘œì¤€)</option>
            <option value="129.0">ë¶€ì‚°/ìš¸ì‚° (+8ë¶„)</option>
            <option value="126.5">ì¸ì²œ/ì œì£¼ (-2ë¶„)</option>
            <option value="128.6">ëŒ€êµ¬/ê²½ë¶ (+6ë¶„)</option>
        </select>
        <select id="birthTime">
            <option value="0">å­ì‹œ (23:30 ~ 01:29)</option><option value="2">ä¸‘ì‹œ (01:30 ~ 03:29)</option>
            <option value="4">å¯…ì‹œ (03:30 ~ 05:29)</option><option value="6">å¯ì‹œ (05:30 ~ 07:29)</option>
            <option value="8">è¾°ì‹œ (07:30 ~ 09:29)</option><option value="10">å·³ì‹œ (09:30 ~ 11:29)</option>
            <option value="12">åˆì‹œ (11:30 ~ 13:29)</option><option value="14">æœªì‹œ (13:30 ~ 15:29)</option>
            <option value="16">ç”³ì‹œ (15:30 ~ 17:29)</option><option value="18">é…‰ì‹œ (17:30 ~ 19:29)</option>
            <option value="20">æˆŒì‹œ (19:30 ~ 21:29)</option><option value="22">äº¥ì‹œ (21:30 ~ 23:29)</option>
        </select>
        
        <div class="section-title">ì²´ì§ˆ ì§„ë‹¨</div>
        <select id="bodyType">
            <option value="unknown">ì²´ì§ˆ: ì˜ ëª¨ë¥´ê² ìŒ (ì§„ë‹¨í•˜ê¸°)</option>
            <option value="íƒœìŒì¸">íƒœìŒì¸ (í—ˆë¦¬ ë°œë‹¬, ê³¨ê²© í¼)</option>
            <option value="ì†ŒìŒì¸">ì†ŒìŒì¸ (í•˜ì²´ ë°œë‹¬, ì†ë°œ ì°¸)</option>
            <option value="ì†Œì–‘ì¸">ì†Œì–‘ì¸ (ìƒì²´ ë°œë‹¬, ì—´ì´ ë§ìŒ)</option>
            <option value="íƒœì–‘ì¸">íƒœì–‘ì¸ (ëª©ëœë¯¸ ë°œë‹¬, ê¸°ì„¸ ê°•í•¨)</option>
        </select>

        <button onclick="checkAndAnalyze()">ìš´ëª…ì  ì‹ë‹¨ ë¶„ì„</button>

        <div id="resultArea">
            <div id="dailyInfo" style="text-align:center; font-size:0.85rem; color:#888; margin-bottom:15px;"></div>
            
            <div class="section-title">ìŒì‹ ê¶í•© ì§ì ‘ ì§„ë‹¨</div>
            <div style="display: flex; gap: 8px;">
                <input type="text" id="userFoodInput" placeholder="ë©”ë‰´ëª… (ì˜ˆ: ë§ˆë¼íƒ•)" style="margin-bottom:0;">
                <button onclick="checkFoodHarmony()" style="width: 85px; padding: 12px; margin-top:0; font-size:0.9rem;">ì§„ë‹¨</button>
            </div>
            <div id="harmonyResult" style="margin: 15px 0; font-size: 0.85rem; font-weight: 700; text-align:center;"></div>

            <div style="height:260px; margin:25px 0;"><canvas id="energyChart"></canvas></div>
            
            <div class="food-info">
                <div id="resTitle" style="font-size:1.3rem; font-weight:700; color:var(--fire); margin-bottom:12px;"></div>
                <div id="resDesc" style="font-size:0.9rem; color:#666; margin-bottom:18px;"></div>
                <div id="resFoodList"></div>
            </div>
            
            <button style="background:#fff; color:var(--ink);" onclick="searchMap()">ğŸ“ ì£¼ë³€ ë§›ì§‘ ì¶”ì²œ</button>
            <div id="balanceAdvice" style="text-align:center; font-size:0.85rem; font-weight:700; margin:30px 0;"></div>
            <button onclick="saveJournal()" style="background:#8e735b; border:none;">ğŸ“œ ì‹ë‹¨ ì¼ê¸°ì¥ ì €ì¥</button>
        </div>
    </div>
</div>

<div id="diagModal" class="modal">
    <div class="modal-content">
        <h3 style="margin-bottom:20px;">ì²´ì§ˆ ìê°€ì§„ë‹¨</h3>
        <div style="text-align:left; font-size:0.95rem; margin-bottom:30px;">
            <label style="margin-bottom:10px; display:block;"><input type="radio" name="q1" value="íƒœìŒì¸"> ê³¨ê²©ì´ í¬ê³  ë¬´ê²Œê°ì´ ìˆë‹¤</label>
            <label style="margin-bottom:10px; display:block;"><input type="radio" name="q1" value="ì†ŒìŒì¸"> í•˜ì²´ ë°œë‹¬, ì†ë°œì´ ì°¨ê³  ì„¸ì‹¬í•˜ë‹¤</label>
            <label style="margin-bottom:10px; display:block;"><input type="radio" name="q1" value="ì†Œì–‘ì¸"> ìƒì²´ ë‹¤ë¶€ì§, ì—´ì´ ë§ê³  ê¸‰í•˜ë‹¤</label>
        </div>
        <button onclick="finishDiag()">ì§„ë‹¨ ì™„ë£Œ</button>
    </div>
</div>

<div id="journalContainer" style="position:fixed; left:-9999px;">
    <div id="journalCapture">
        <h2 style="text-align:center; letter-spacing:10px; border-bottom:2px solid #2c2c2c; padding-bottom:15px;">é£Ÿå–® æ—¥è¨˜</h2>
        <div id="jUser" style="margin:20px 0; font-weight:700;"></div>
        <div id="jList" style="margin:30px 0; line-height:2.2;"></div>
        <div class="sungsun-box"><div id="jSWord" style="font-size:1.6rem; font-weight:700;"></div><div id="jSMean" style="font-size:0.9rem;"></div></div>
    </div>
</div>

<script>
    // [ê¸°ì¡´ì˜ ì •ë°€ ë¶„ì„ ë¡œì§, ë°ì´í„°ì…‹, íš¨ëŠ¥ íŒì—… ë¡œì§ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤]
    let chart=null, baseCounts={}, diaryCounts={'ëª©':0,'í™”':0,'í† ':0,'ê¸ˆ':0,'ìˆ˜':0}, diaryLog=[], currentLack='';
    const foodFiveElements = { 'ì¹˜í‚¨':'ëª©', 'ìƒëŸ¬ë“œ':'ëª©', 'ë§ˆë¼íƒ•':'í™”', 'í”¼ì':'í™”', 'ì‚¼ê²¹ì‚´':'ìˆ˜', 'íšŒ':'ìˆ˜', 'ë¹µ':'í† ', 'ë² ì´ê¸€':'í† ', 'ì„¤ë íƒ•':'ê¸ˆ', 'ëˆì¹´ì¸ ':'ê¸ˆ' };
    const foodEffects = { 'ê·¸ë¦­ ìš”ê±°íŠ¸ ë³¼':'ê°„ í•´ë…ê³¼ ìƒê¸°ë¥¼ ê¹¨ì›ë‹ˆë‹¤.', 'ë§ˆë¼íƒ•(1ë‹¨ê³„)':'ì‹¬ì¥ í™”ê¸°ë¥¼ ì¡°ê·¹í•´ í™œë ¥ì„ ì¤ë‹ˆë‹¤.', 'ë°¤ í‹°ë¼ë¯¸ìˆ˜':'ë¹„ìœ„ì˜ ë¶€ì¡±í•œ ì—ë„ˆì§€ë¥¼ ë³´ê°•í•©ë‹ˆë‹¤.', 'í‰ì–‘ëƒ‰ë©´':'ì‹ ì¥ì˜ ëŒ€ì‚¬ë¥¼ ë•ê³  ì—´ì„ ì‹í™ë‹ˆë‹¤.' };
    const data = {
        'ëª©': { t:'æœ¨: í‘¸ë¥¸ ìƒê¸°', desc:'ê°„(è‚)ì˜ ê¸°ìš´ì„ ë•ëŠ” ì‹±ê·¸ëŸ¬ìš´ ì²˜ë°©ì…ë‹ˆë‹¤.', f:{base:['ê·¸ë¦­ ìš”ê±°íŠ¸ ë³¼','í¬ì¼€'], spring:['ë¯¸ë‚˜ë¦¬ ì‚¼ê²¹ì‚´'], winter:['ì‹œê¸ˆì¹˜ í”„ë¦¬íƒ€íƒ€']}, c:'#5d7a66', k:'í¬ì¼€ ìƒëŸ¬ë“œ ë§›ì§‘' },
        'í™”': { t:'ç«: ë¶‰ì€ ì˜¨ê¸°', desc:'ì‹¬ì¥(å¿ƒ)ì˜ ì—´ì„ ë‹¤ìŠ¤ë¦¬ëŠ” í™œê¸°ì°¬ ì²˜ë°©ì…ë‹ˆë‹¤.', f:{base:['ë§ˆë¼íƒ•(1ë‹¨ê³„)','ë‚™ê³±ìƒˆ'], summer:['ë¬¼íšŒ'], autumn:['ìëª½ íƒ€ë¥´íŠ¸']}, c:'#a64e4e', k:'ë§ˆë¼íƒ• ë‚™ê³±ìƒˆ ë§›ì§‘' },
        'í† ': { t:'åœŸ: í™©ìƒ‰ ì¤‘ì‹¬', desc:'ë¹„ì¥(è„¾)ì„ ë³´ê°•í•˜ëŠ” í¸ì•ˆí•œ ì²˜ë°©ì…ë‹ˆë‹¤.', f:{base:['ë“¤ê¸°ë¦„ ë§‰êµ­ìˆ˜','ë² ì´ê¸€'], autumn:['ë°¤ í‹°ë¼ë¯¸ìˆ˜'], spring:['ì˜¥ìˆ˜ìˆ˜ ì†¥ë°¥']}, c:'#c4a46d', k:'ë² ì´ê¸€ ë§‰êµ­ìˆ˜ ë§›ì§‘' },
        'ê¸ˆ': { t:'é‡‘: ë°±ìƒ‰ ê²°ì‹¤', desc:'í(è‚º)ì˜ ê¸°ìš´ì„ ì‘ì§‘ì‹œí‚¤ëŠ” ë‹´ë°±í•œ ì²˜ë°©ì…ë‹ˆë‹¤.', f:{base:['ë‹­í•œë§ˆë¦¬','íŠ¸ëŸ¬í”Œ ë¦¬ì¡°ë˜'], autumn:['ë°° ì†Œë¥´ë² '], winter:['ì¡°ê°œìˆ ì°œ']}, c:'#8a8a8a', k:'ë‹­í•œë§ˆë¦¬ ë¦¬ì¡°ë˜ ë§›ì§‘' },
        'ìˆ˜': { t:'æ°´: ê²€ì€ ì§€ë¡€', desc:'ì‹ ì¥(è…) ì›ê¸°ë¥¼ ì±„ìš°ëŠ” ê¹Šì€ í’ë¯¸ì˜ ì²˜ë°©ì…ë‹ˆë‹¤.', f:{base:['í‰ì–‘ëƒ‰ë©´','ëˆì¹´ì¸ '], winter:['ë°©ì–´íšŒ'], summer:['ì¥ì–´ë®ë°¥']}, c:'#4e657a', k:'í‰ì–‘ëƒ‰ë©´ ëˆì¹´ì¸  ë§›ì§‘' }
    };

    function getCurrentSeason() { const m = new Date().getMonth()+1; if(m>=3 && m<=5) return 'spring'; if(m>=6 && m<=8) return 'summer'; if(m>=9 && m<=11) return 'autumn'; return 'winter'; }
    function checkAndAnalyze() { if(document.getElementById('bodyType').value === 'unknown') document.getElementById('diagModal').style.display='flex'; else analyze(); }
    function finishDiag() { const q = document.querySelector('input[name="q1"]:checked'); if(!q) return alert("ì²´í¬í•´ ì£¼ì„¸ìš”."); document.getElementById('bodyType').value = q.value; document.getElementById('diagModal').style.display='none'; analyze(); }
    
    function checkFoodHarmony() {
        const input = document.getElementById('userFoodInput').value.trim(); if(!input) return;
        let foodEnergy = 'ì•Œ ìˆ˜ ì—†ìŒ'; for(let key in foodFiveElements) { if(input.includes(key)) { foodEnergy = foodFiveElements[key]; break; } }
        const resDiv = document.getElementById('harmonyResult');
        if(foodEnergy === currentLack) { resDiv.innerHTML = `âœ… ì°°ë–¡ê¶í•©! ë¶€ì¡±í•œ ${foodEnergy} ê¸°ìš´ì„ ì±„ì›Œì¤ë‹ˆë‹¤.`; resDiv.style.color="var(--wood)"; }
        else { resDiv.innerHTML = `ğŸ§ '${input}'ì€(ëŠ”) ${foodEnergy} ê¸°ìš´ì´ ê°•í•©ë‹ˆë‹¤. ë¶€ì¡±í•œ ${currentLack} ê¸°ìš´ë„ ê³ë“¤ì—¬ë³´ì„¸ìš”.`; resDiv.style.color="var(--ink)"; }
    }

    function analyze() {
        const b=document.getElementById('birthDate').value;
        const solar=Solar.fromYmdHms(new Date(b).getFullYear(), new Date(b).getMonth()+1, new Date(b).getDate(), parseInt(document.getElementById('birthTime').value), 0, 0);
        const tLunar=Solar.fromDate(new Date()).getLunar();
        const map={'ç”²':'ëª©','ä¹™':'ëª©','å¯…':'ëª©','å¯':'ëª©','ä¸™':'í™”','ä¸':'í™”','å·³':'í™”','åˆ':'í™”','æˆŠ':'í† ','å·±':'í† ','è¾°':'í† ','æˆŒ':'í† ','ä¸‘':'í† ','æœª':'í† ','åºš':'ê¸ˆ','è¾›':'ê¸ˆ','ç”³':'ê¸ˆ','é…‰':'ê¸ˆ','å£¬':'ìˆ˜','ç™¸':'ìˆ˜','äº¥':'ìˆ˜','å­':'ìˆ˜'};
        baseCounts={'ëª©':0,'í™”':0,'í† ':0,'ê¸ˆ':0,'ìˆ˜':0};
        const my8=solar.getLunar().getEightChar();
        [my8.getYearGan(),my8.getYearZhi(),my8.getMonthGan(),my8.getMonthZhi(),my8.getDayGan(),my8.getDayZhi(),my8.getTimeGan(),my8.getTimeZhi(),tLunar.getDayGan(),tLunar.getDayZhi()].forEach(c=>{if(map[c])baseCounts[map[c]]++;});
        currentLack=Object.entries(baseCounts).sort((a,b)=>a[1]-b[1])[0][0];
        const season=getCurrentSeason();
        document.getElementById('dailyInfo').innerText=`${document.getElementById('bodyType').value} | ${tLunar.getDayInGanZhi()}ì¼`;
        document.getElementById('resTitle').innerText=`${document.getElementById('bodyType').value} ë§ì¶¤ ${data[currentLack].t}`;
        document.getElementById('resDesc').innerHTML=data[currentLack].desc;
        const foods = [...(data[currentLack].f[season] || []), ...data[currentLack].f.base];
        document.getElementById('resFoodList').innerHTML = foods.map(f => `<span class="food-tag" onclick="showFood('${f}')">#${f}</span>`).join('');
        renderChart(baseCounts); document.getElementById('resultArea').style.display='block';
    }

    function showFood(name) {
        const effect = foodEffects[name] || "ê·€í•˜ì˜ ì˜¤í–‰ ê· í˜•ì„ ë§ì¶”ëŠ” ìµœì ì˜ íŠ¸ë Œë”” ë©”ë‰´ì…ë‹ˆë‹¤.";
        if(confirm(`[${name}ì˜ íš¨ëŠ¥]\n${effect}\n\nì§€ê¸ˆ ë“œì…¨ë‚˜ìš”? (ê¸°ë¡í•˜ê¸°)`)) addDiary(currentLack, name);
    }
    function addDiary(type, name) { diaryCounts[type]++; diaryLog.push({n:name, t:new Date().toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'})}); renderChart(baseCounts); }
    
    function renderChart(c){
        const ctx=document.getElementById('energyChart').getContext('2d');
        const finalData = ['ëª©','í™”','í† ','ê¸ˆ','ìˆ˜'].map(k => c[k] + diaryCounts[k]);
        if(chart) chart.destroy();
        chart=new Chart(ctx,{type:'radar',data:{labels:['ëª©','í™”','í† ','ê¸ˆ','ìˆ˜'],datasets:[{data:finalData,backgroundColor:'rgba(0,0,0,0.05)',borderColor:'#2c2c2c',borderWidth:1.5}]},options:{scales:{r:{beginAtZero:true,max:8,ticks:{display:false}}},plugins:{legend:{display:false}}}});
    }

    function saveJournal() {
        const name=document.getElementById('userNameInput').value||"ê·€í•˜";
        document.getElementById('jUser').innerText=`${name} ë‹˜ì˜ ì‹ê²° ë³´ì „`;
        document.getElementById('jList').innerHTML=diaryLog.map(l=>`<div><b>[${l.t}]</b> ${l.n} ì„­ì·¨</div>`).join('');
        document.getElementById('jSWord').innerText='ä¸­å’Œä¹‹æ°£'; document.getElementById('jSMean').innerText='ìŒì–‘ì˜ ê· í˜•ì„ ì´ë£¨ì—ˆìŠµë‹ˆë‹¤.';
        const target=document.getElementById('journalCapture'); target.style.display='block';
        html2canvas(target,{scale:2}).then(canvas=>{const a=document.createElement('a'); a.download=`ì‹ê²°_ì¼ê¸°.png`; a.href=canvas.toDataURL(); a.click(); target.style.display='none';});
    }
    function searchMap(){window.open(`https://m.map.naver.com/search2/search.naver?query=${encodeURIComponent(data[currentLack].k)}`,'_blank');}
</script>
</body>
</html>
        <input type="text" id="userNameInput" placeholder="ì„±í•¨ (ë˜ëŠ” í˜¸)">
        <div style="display: flex; gap: 15px; margin-bottom: 15px; font-size: 0.9rem;">
            <label><input type="radio" name="gender" value="ë‚¨" checked> ë‚¨ì„±</label>
            <label><input type="radio" name="gender" value="ì—¬"> ì—¬ì„±</label>
        </div>
        
        <input type="date" id="birthDate" value="1995-01-01">
        <select id="birthCity">
            <option value="127.0">ì„œìš¸/ê²½ê¸° (í‘œì¤€)</option>
            <option value="129.0">ë¶€ì‚°/ìš¸ì‚° (+8ë¶„)</option>
            <option value="126.5">ì¸ì²œ/ì œì£¼ (-2ë¶„)</option>
            <option value="128.6">ëŒ€êµ¬/ê²½ë¶ (+6ë¶„)</option>
        </select>
        <select id="birthTime">
            <option value="0">å­ì‹œ (23:30 ~ 01:29)</option><option value="2">ä¸‘ì‹œ (01:30 ~ 03:29)</option>
            <option value="4">å¯…ì‹œ (03:30 ~ 05:29)</option><option value="6">å¯ì‹œ (05:30 ~ 07:29)</option>
            <option value="8">è¾°ì‹œ (07:30 ~ 09:29)</option><option value="10">å·³ì‹œ (09:30 ~ 11:29)</option>
            <option value="12">åˆì‹œ (11:30 ~ 13:29)</option><option value="14">æœªì‹œ (13:30 ~ 15:29)</option>
            <option value="16">ç”³ì‹œ (15:30 ~ 17:29)</option><option value="18">é…‰ì‹œ (17:30 ~ 19:29)</option>
            <option value="20">æˆŒì‹œ (19:30 ~ 21:29)</option><option value="22">äº¥ì‹œ (21:30 ~ 23:29)</option>
        </select>
        
        <select id="bodyType">
            <option value="unknown">ì²´ì§ˆ: ì˜ ëª¨ë¥´ê² ìŒ (ì§„ë‹¨í•˜ê¸°)</option>
            <option value="íƒœìŒì¸">í—ˆë¦¬ ë°œë‹¬, ê³¨ê²© í¼ (íƒœìŒì¸)</option>
            <option value="ì†ŒìŒì¸">í•˜ì²´ ë°œë‹¬, ì•„ë‹´í•¨ (ì†ŒìŒì¸)</option>
            <option value="ì†Œì–‘ì¸">ìƒì²´ ë°œë‹¬, ì—‰ë©ì´ ê°€ë²¼ì›€ (ì†Œì–‘ì¸)</option>
            <option value="íƒœì–‘ì¸">ëª©ëœë¯¸ê°€ êµµê³  ê¸°ì„¸ê°€ ê°•í•¨ (íƒœì–‘ì¸)</option>
        </select>

        <button onclick="checkAndAnalyze()">ìš´ëª…ì  ì‹ë‹¨ ë¶„ì„</button>

        <div id="resultArea">
            <div id="dailyInfo" style="text-align:center; font-size:0.85rem; color:#888;"></div>
            <div style="height:260px; margin:20px 0;"><canvas id="energyChart"></canvas></div>
            <div class="food-info">
                <div id="resTitle" style="font-size:1.3rem; font-weight:700; color:var(--fire); margin-bottom:10px;"></div>
                <div id="resDesc" style="font-size:0.9rem; color:#666; margin-bottom:15px;"></div>
                <div id="resFoodList"></div>
            </div>
            <button style="background:#fff; color:var(--ink);" onclick="searchMap()">ğŸ“ ì£¼ë³€ ë§›ì§‘ ì¶”ì²œ</button>
            <div id="balanceAdvice" style="text-align:center; font-size:0.85rem; font-weight:700; margin:25px 0;"></div>
            <button onclick="saveJournal()" style="background:#8e735b; border:none;">ğŸ“œ ì‹ë‹¨ ì¼ê¸°ì¥ ì €ì¥</button>
        </div>
    </div>
</div>

<div id="diagModal" class="modal">
    <div class="modal-content">
        <h3>ì²´ì§ˆ ìê°€ì§„ë‹¨</h3>
        <p style="font-size:0.8rem; color:#666;">ê°€ì¥ ê°€ê¹Œìš´ íŠ¹ì§•ì„ ê³¨ë¼ì£¼ì„¸ìš”.</p>
        <div style="text-align:left; margin-top:20px;">
            <label><input type="radio" name="q1" value="íƒœìŒì¸"> ì²´ê²©ì´ í¬ê³  ì†Œí™”ë ¥ì´ ì¢‹ë‹¤</label><br>
            <label><input type="radio" name="q1" value="ì†ŒìŒì¸"> ìƒì²´ë³´ë‹¤ í•˜ì²´ë°œë‹¬, ì†ë°œì´ ì°¨ë‹¤</label><br>
            <label><input type="radio" name="q1" value="ì†Œì–‘ì¸"> ê°€ìŠ´ ë°œë‹¬, ì„±ê²©ì´ ê¸‰í•˜ê³  ì—´ì´ ë§ë‹¤</label>
        </div>
        <button onclick="finishDiag()" style="margin-top:20px;">ì§„ë‹¨ ì™„ë£Œ</button>
    </div>
</div>

<div id="journalContainer" style="position:fixed; left:-9999px;">
    <div id="journalCapture">
        <h2 style="text-align:center; letter-spacing:10px; border-bottom:2px solid #2c2c2c; padding-bottom:15px;">é£Ÿå–® æ—¥è¨˜</h2>
        <div id="jUser" style="margin:20px 0; font-weight:700;"></div>
        <div id="jList" style="margin:30px 0; line-height:2;"></div>
        <div class="sungsun-box"><div id="jSWord" style="font-size:1.6rem; font-weight:700;"></div><div id="jSMean" style="font-size:0.9rem;"></div></div>
    </div>
</div>

<script>
    let chart=null, baseCounts={}, diaryCounts={'ëª©':0,'í™”':0,'í† ':0,'ê¸ˆ':0,'ìˆ˜':0}, diaryLog=[], currentLack='';
    
    const foodEffects = {
        'ê·¸ë¦­ ìš”ê±°íŠ¸ ë³¼': 'í‘¸ë¥¸ ê³¼ì¼ê³¼ ìœ ì‚°ê· ì´ ê°„ í•´ë…ê³¼ ìƒê¸°ë¥¼ ê¹¨ì›ë‹ˆë‹¤.',
        'ë°”ì§ˆ í˜ìŠ¤í†  íŒŒìŠ¤íƒ€': 'ì‹ ì„ í•œ í—ˆë¸Œ í–¥ì´ ê°„ ê¸°ìš´ì˜ ì •ì²´ë¥¼ í’€ì–´ì¤ë‹ˆë‹¤.',
        'ë§ˆë¼íƒ•(1ë‹¨ê³„)': 'ì‹¬ì¥ì˜ í™”ê¸°ë¥¼ ìê·¹í•´ í˜ˆí–‰ê³¼ ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œë¥¼ ë•ìŠµë‹ˆë‹¤.',
        'ë°¤ í‹°ë¼ë¯¸ìˆ˜': 'ë‹¬ì½¤í•œ ë°¤ì˜ ê¸°ìš´ì´ ë¹„ìœ„ì˜ ë¶€ì¡±í•œ ì—ë„ˆì§€ë¥¼ ì±„ì›ë‹ˆë‹¤.',
        'íŠ¸ëŸ¬í”Œ í¬ë¦¼ ë¦¬ì¡°ë˜': 'í ê¸°ìš´ì„ ì‘ì§‘ì‹œì¼œ ë©´ì—­ë ¥ì„ ê°•í™”í•˜ê³  ë§ˆìŒì„ ì•ˆì •ì‹œí‚µë‹ˆë‹¤.',
        'í‰ì–‘ëƒ‰ë©´': 'ë§‘ì€ ìœ¡ìˆ˜ê°€ ì‹ ì¥ì˜ ìˆ˜ë¶„ ëŒ€ì‚¬ë¥¼ ë•ê³  ì—´ì„ ì‹í˜€ì¤ë‹ˆë‹¤.'
    };

    const data = {
        'ëª©': { t:'æœ¨: í‘¸ë¥¸ ìƒê¸° ì²˜ë°©', desc:'ê°„(è‚)ì˜ ê¸°ìš´ì„ ë•ëŠ” ì‹±ê·¸ëŸ¬ìš´ ì‹ë‹¨ì…ë‹ˆë‹¤.', f:{base:['ê·¸ë¦­ ìš”ê±°íŠ¸ ë³¼','ë°”ì§ˆ í˜ìŠ¤í†  íŒŒìŠ¤íƒ€','í¬ì¼€'], spring:['ë¯¸ë‚˜ë¦¬ ì‚¼ê²¹ì‚´','ë‹¬ë˜ íŒŒìŠ¤íƒ€'], winter:['ì‹œê¸ˆì¹˜ í”„ë¦¬íƒ€íƒ€']}, c:'#5d7a66', k:'í¬ì¼€ ìƒëŸ¬ë“œ ë§›ì§‘' },
        'í™”': { t:'ç«: ë¶‰ì€ ì˜¨ê¸° ì²˜ë°©', desc:'ì‹¬ì¥(å¿ƒ)ì˜ ì—´ì„ ë‹¤ìŠ¤ë¦¬ëŠ” í™œê¸°ì°¬ ì‹ë‹¨ì…ë‹ˆë‹¤.', f:{base:['ë§ˆë¼íƒ•(1ë‹¨ê³„)','ë§ˆë¥´ê²Œë¦¬ë”° í”¼ì','ë‚™ê³±ìƒˆ'], summer:['ë¬¼íšŒ','ì•„ì‚¬ì´ë³¼'], autumn:['ìëª½ íƒ€ë¥´íŠ¸']}, c:'#a64e4e', k:'ë§ˆë¼íƒ• ë‚™ê³±ìƒˆ ë§›ì§‘' },
        'í† ': { t:'åœŸ: í™©ìƒ‰ ì¤‘ì‹¬ ì²˜ë°©', desc:'ë¹„ì¥(è„¾)ì„ ë³´ê°•í•˜ëŠ” í¸ì•ˆí•œ ì‹ë‹¨ì…ë‹ˆë‹¤.', f:{base:['ë“¤ê¸°ë¦„ ë§‰êµ­ìˆ˜','ë² ì´ê¸€','ë‹¨í˜¸ë°• ë‡¨ë¼'], autumn:['ë°¤ í‹°ë¼ë¯¸ìˆ˜','ê³ êµ¬ë§ˆ íœ˜ë‚­ì‹œì—'], spring:['ì˜¥ìˆ˜ìˆ˜ ì†¥ë°¥']}, c:'#c4a46d', k:'ë§‰êµ­ìˆ˜ ë² ì´ê¸€ ë§›ì§‘' },
        'ê¸ˆ': { t:'é‡‘: ë°±ìƒ‰ ê²°ì‹¤ ì²˜ë°©', desc:'í(è‚º)ì˜ ê¸°ìš´ì„ ì‘ì§‘ì‹œí‚¤ëŠ” ë‹´ë°±í•œ ì‹ë‹¨ì…ë‹ˆë‹¤.', f:{base:['ë‹­í•œë§ˆë¦¬','íŠ¸ëŸ¬í”Œ í¬ë¦¼ ë¦¬ì¡°ë˜','êµ´ íŒŒìŠ¤íƒ€'], autumn:['ë°° ì†Œë¥´ë² '], winter:['ì¡°ê°œìˆ ì°œ']}, c:'#8a8a8a', k:'ë‹­í•œë§ˆë¦¬ ë¦¬ì¡°ë˜ ë§›ì§‘' },
        'ìˆ˜': { t:'æ°´: ê²€ì€ ì§€ë¡€ ì²˜ë°©', desc:'ì‹ ì¥(è…) ì›ê¸°ë¥¼ ì±„ìš°ëŠ” ê¹Šì€ í’ë¯¸ì˜ ì‹ë‹¨ì…ë‹ˆë‹¤.', f:{base:['í‰ì–‘ëƒ‰ë©´','ëˆì¹´ì¸ ','ì „ë³µ ì†¥ë°¥'], winter:['ë°©ì–´íšŒ'], summer:['ì¥ì–´ë®ë°¥']}, c:'#4e657a', k:'í‰ì–‘ëƒ‰ë©´ ëˆì¹´ì¸  ë§›ì§‘' }
    };

    function getCurrentSeason() {
        const m = new Date().getMonth()+1;
        if(m>=3 && m<=5) return 'spring'; if(m>=6 && m<=8) return 'summer'; if(m>=9 && m<=11) return 'autumn'; return 'winter';
    }

    function checkAndAnalyze() {
        if(document.getElementById('bodyType').value === 'unknown') document.getElementById('diagModal').style.display='flex';
        else analyze();
    }

    function finishDiag() {
        const q = document.querySelector('input[name="q1"]:checked');
        if(!q) return alert("ì²´í¬í•´ ì£¼ì„¸ìš”.");
        document.getElementById('bodyType').value = q.value;
        document.getElementById('diagModal').style.display='none';
        analyze();
    }

    function analyze() {
        const b=document.getElementById('birthDate').value;
        const solar=Solar.fromYmdHms(new Date(b).getFullYear(), new Date(b).getMonth()+1, new Date(b).getDate(), parseInt(document.getElementById('birthTime').value), 0, 0);
        const tLunar=Solar.fromDate(new Date()).getLunar();
        const map={'ç”²':'ëª©','ä¹™':'ëª©','å¯…':'ëª©','å¯':'ëª©','ä¸™':'í™”','ä¸':'í™”','å·³':'í™”','åˆ':'í™”','æˆŠ':'í† ','å·±':'í† ','è¾°':'í† ','æˆŒ':'í† ','ä¸‘':'í† ','æœª':'í† ','åºš':'ê¸ˆ','è¾›':'ê¸ˆ','ç”³':'ê¸ˆ','é…‰':'ê¸ˆ','å£¬':'ìˆ˜','ç™¸':'ìˆ˜','äº¥':'ìˆ˜','å­':'ìˆ˜'};
        baseCounts={'ëª©':0,'í™”':0,'í† ':0,'ê¸ˆ':0,'ìˆ˜':0};
        const my8=solar.getLunar().getEightChar();
        [my8.getYearGan(),my8.getYearZhi(),my8.getMonthGan(),my8.getMonthZhi(),my8.getDayGan(),my8.getDayZhi(),my8.getTimeGan(),my8.getTimeZhi(),tLunar.getDayGan(),tLunar.getDayZhi()].forEach(c=>{if(map[c])baseCounts[map[c]]++;});
        
        currentLack=Object.entries(baseCounts).sort((a,b)=>a[1]-b[1])[0][0];
        const body=document.getElementById('bodyType').value;
        const season=getCurrentSeason();
        const seasonLabels={spring:'ğŸŒ¸ ë´„', summer:'â˜€ï¸ ì—¬ë¦„', autumn:'ğŸ‚ ê°€ì„', winter:'â„ï¸ ê²¨ìš¸'};

        document.getElementById('dailyInfo').innerText=`${body} | ${seasonLabels[season]} ì‹œì¦Œ | ${tLunar.getDayInGanZhi()}ì¼`;
        document.getElementById('resTitle').innerText=`${body} ë§ì¶¤ ${data[currentLack].t}`;
        document.getElementById('resDesc').innerHTML=data[currentLack].desc;
        
        // ë©”ë‰´ ì¶œë ¥ ë° íš¨ëŠ¥ íŒì—… ì—°ê²°
        const foods = [...(data[currentLack].f[season] || []), ...data[currentLack].f.base];
        document.getElementById('resFoodList').innerHTML = foods.map(f => `<span class="food-tag" onclick="showFood('${f}')">#${f}</span>`).join('');
        
        renderChart(baseCounts);
        document.getElementById('resultArea').style.display='block';
    }

    function showFood(name) {
        const effect = foodEffects[name] || "ê·€í•˜ì˜ ì˜¤í–‰ ê· í˜•ì„ ë§ì¶”ëŠ” ìµœì ì˜ íŠ¸ë Œë”” ë©”ë‰´ì…ë‹ˆë‹¤.";
        if(confirm(`[${name}ì˜ íš¨ëŠ¥]\n${effect}\n\nì§€ê¸ˆ ë“œì…¨ë‚˜ìš”? (ê¸°ë¡í•˜ê¸°)`)) addDiary(currentLack, name);
    }

    function addDiary(type, name) {
        diaryCounts[type]++;
        diaryLog.push({n:name, t:new Date().toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'})});
        const final={}; for(let k in baseCounts) final[k]=baseCounts[k]+diaryCounts[k];
        const sorted=Object.entries(final).sort((a,b)=>a[1]-b[1]);
        document.getElementById('balanceAdvice').innerText= (sorted[4][1]-sorted[0][1]<=1) ? "â˜¯ï¸ ì™„ë²½í•œ ì¤‘í™” ìƒíƒœì…ë‹ˆë‹¤!" : `'${sorted[0][0]}' ê¸°ìš´ì„ ì¡°ê¸ˆ ë” ì±„ìš°ì„¸ìš”.`;
    }

    function renderChart(c){
        const ctx=document.getElementById('energyChart').getContext('2d');
        if(chart) chart.destroy();
        chart=new Chart(ctx,{type:'radar',data:{labels:['ëª©','í™”','í† ','ê¸ˆ','ìˆ˜'],datasets:[{data:[c['ëª©'],c['í™”'],c['í† '],c['ê¸ˆ'],c['ìˆ˜']],backgroundColor:'rgba(0,0,0,0.05)',borderColor:'#2c2c2c',borderWidth:1}]},options:{scales:{r:{beginAtZero:true,max:7,ticks:{display:false}}},plugins:{legend:{display:false}}}});
    }

    function saveJournal() {
        const name=document.getElementById('userNameInput').value||"ê·€í•˜";
        document.getElementById('jDate').innerText=new Date().toLocaleDateString();
        document.getElementById('jUser').innerText=`${name} ë‹˜ì˜ ì‹ê²° ë³´ì „`;
        document.getElementById('jList').innerHTML=diaryLog.map(l=>`<div><b>[${l.t}]</b> ${l.n} ì„­ì·¨</div>`).join('');
        const lackEl = Object.entries(baseCounts).sort((a,b)=>a[1]-b[1])[0][0];
        const s = (lackEl === 'ëª©') ? {w:'æ¯æœ¨é€¢æ˜¥', m:'ë´„ì˜ ìƒê¸°ê°€ ê¹ƒë“­ë‹ˆë‹¤.'} : {w:'ä¸Šå–„è‹¥æ°´', m:'ìœ ì—°í•œ ì§€í˜œë¥¼ ì–»ìŠµë‹ˆë‹¤.'};
        document.getElementById('jSWord').innerText=s.w; document.getElementById('jSMean').innerText=s.m;
        const target=document.getElementById('journalCapture'); target.style.display='block';
        html2canvas(target,{scale:2}).then(canvas=>{const a=document.createElement('a'); a.download=`ì‹ê²°_ì¼ê¸°.png`; a.href=canvas.toDataURL(); a.click(); target.style.display='none';});
    }
    function searchMap(){window.open(`https://m.map.naver.com/search2/search.naver?query=${encodeURIComponent(data[currentLack].k)}`,'_blank');}
</script>
</body>
</html>
