<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ì‹ê²°(é£Ÿçµ) - ë‚˜ë§Œì˜ ì‚¬ì£¼ ì‹ë‹¨ ë³´ì „</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&display=swap');
        :root { --paper: #f4f1ea; --ink: #2c2c2c; --wood: #5d7a66; --fire: #a64e4e; --earth: #c4a46d; --metal: #8a8a8a; --water: #4e657a; }
        body { font-family: 'Noto Serif KR', serif; background-color: #e0ddd5; margin: 0; padding: 20px; color: var(--ink); }
        .app-container { max-width: 420px; margin: auto; background: var(--paper); border: 1px solid #d1cdbf; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .header { padding: 40px 20px; text-align: center; border-bottom: 1px double #d1cdbf; }
        .content { padding: 25px; }
        input, select { width: 100%; border: none; border-bottom: 1px solid #ccc; background: transparent; padding: 12px 5px; margin-bottom: 15px; font-family: inherit; font-size: 1rem; outline: none; box-sizing: border-box; }
        button { width: 100%; padding: 16px; border: 1px solid var(--ink); background: var(--ink); color: white; cursor: pointer; font-family: inherit; transition: 0.3s; }
        #resultArea { display: none; margin-top: 30px; }
        .chart-box { height: 240px; margin: 20px 0; }
        .food-info { border-left: 3px solid var(--ink); padding-left: 15px; margin: 25px 0; }
        .diary-btns { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin: 20px 0; }
        .diary-btns button { padding: 8px 2px; font-size: 0.7rem; border-radius: 4px; }
        #journalCapture { display: none; width: 380px; padding: 40px; background: var(--paper); border: 2px solid var(--ink); color: var(--ink); }
        .sungsun-box { margin-top: 30px; padding: 15px; border: 1px double var(--ink); text-align: center; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header"><h1>é£Ÿ çµ</h1><p>ì‚¬ì£¼ì™€ ì¼ì§„ìœ¼ë¡œ ë§ºì–´ì£¼ëŠ” ì²˜ë°©</p></div>
    <div class="content">
        <input type="text" id="userNameInput" placeholder="ì´ë¦„ (ë˜ëŠ” í˜¸)ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        <input type="date" id="birthDate" value="1995-01-01">
        <select id="birthTime">
    <option value="0">å­ì‹œ (23:30 ~ 01:29)</option>
    <option value="2">ä¸‘ì‹œ (01:30 ~ 03:29)</option>
    <option value="4">å¯…ì‹œ (03:30 ~ 05:29)</option>
    <option value="6">å¯ì‹œ (05:30 ~ 07:29)</option>
    <option value="8">è¾°ì‹œ (07:30 ~ 09:29)</option>
    <option value="10">å·³ì‹œ (09:30 ~ 11:29)</option>
    <option value="12">åˆì‹œ (11:30 ~ 13:29)</option>
    <option value="14">æœªì‹œ (13:30 ~ 15:29)</option>
    <option value="16">ç”³ì‹œ (15:30 ~ 17:29)</option>
    <option value="18">é…‰ì‹œ (17:30 ~ 19:29)</option>
    <option value="20">æˆŒì‹œ (19:30 ~ 21:29)</option>
    <option value="22">äº¥ì‹œ (21:30 ~ 23:29)</option>
</select>

        <button onclick="analyze()">ë‚˜ì˜ ê¸°ìš´ ë¶„ì„</button>

        <div id="resultArea">
            <div id="captureArea" style="background:var(--paper); padding:15px;">
                <div id="dailyFortune" style="text-align:center; font-size:0.8rem; margin-bottom:15px; opacity:0.7;"></div>
                <div class="chart-box"><canvas id="energyChart"></canvas></div>
                <div class="food-info">
                    <div id="resTitle" style="font-size:1.2rem; font-weight:700; color:var(--fire);"></div>
                    <div id="resFood" style="font-size:0.9rem; margin-top:10px;"></div>
                </div>
            </div>
            
            <button style="background:#fff; color:#2c2c2c; margin-bottom:10px;" onclick="window.open('https://m.map.naver.com/search2/search.naver?query='+encodeURIComponent(currentKeyword))">ğŸ“ ì£¼ë³€ ë§ì¶¤ ë§›ì§‘ ê²€ìƒ‰</button>

            <div class="diary-btns">
                <button style="background:#f0f7f0; color:#5d7a66;" onclick="addDiary('ëª©')">ğŸŒ¿ëª©</button>
                <button style="background:#fff5f5; color:#a64e4e;" onclick="addDiary('í™”')">ğŸ”¥í™”</button>
                <button style="background:#fffdf5; color:#c4a46d;" onclick="addDiary('í† ')">â›°ï¸í† </button>
                <button style="background:#f5f5f5; color:#8a8a8a;" onclick="addDiary('ê¸ˆ')">ğŸ’ê¸ˆ</button>
                <button style="background:#f5f8fa; color:#4e657a;" onclick="addDiary('ìˆ˜')">ğŸŒŠìˆ˜</button>
            </div>
            <div id="balanceAdvice" style="text-align:center; font-size:0.8rem; margin:10px 0; font-weight:700;"></div>
            <button onclick="saveJournal()" style="background:#8e735b; border:none;">ğŸ“œ ì˜¤ëŠ˜ì˜ ì‹ë‹¨ ì¼ê¸°ì¥ ì €ì¥</button>
        </div>
    </div>
</div>

<div id="journalContainer" style="position:fixed; left:-9999px;">
    <div id="journalCapture">
        <div id="jDate" style="text-align:right; font-size:0.8rem;"></div>
        <h2 style="text-align:center; letter-spacing:10px;">é£Ÿå–® æ—¥è¨˜</h2>
        <div id="jList" style="margin:30px 0; min-height:100px; border-top:1px solid #2c2c2c; padding-top:20px;"></div>
        <div class="sungsun-box"><div id="jSWord" style="font-size:1.3rem; font-weight:700;"></div><div id="jSMean" style="font-size:0.8rem;"></div></div>
        <div id="jUser" style="text-align:right; margin-top:30px; font-weight:700;"></div>
    </div>
</div>

<script>
    let chart=null, baseCounts={}, diaryCounts={'ëª©':0,'í™”':0,'í† ':0,'ê¸ˆ':0,'ìˆ˜':0}, diaryLog=[], currentKeyword='';
    const data={
        'ëª©':{t:'æœ¨: í‘¸ë¥¸ ìƒê¸°', f:'ë¶€ì¶”, ë¯¸ë‚˜ë¦¬, ë‹­ê³ ê¸°, ë§¤ì‹¤', c:'#5d7a66', k:'ìƒëŸ¬ë“œ ë³´ë¦¬ë°¥ ë§›ì§‘', s:{w:'æ¯æœ¨é€¢æ˜¥', m:'ë§ˆë¥¸ ë‚˜ë¬´ê°€ ë´„ì„ ë§Œë‚˜ë“¯ ìƒê¸°ê°€ í•„ìš”í•œ ë•Œ'}},
        'í™”':{t:'ç«: ë¶‰ì€ ì˜¨ê¸°', f:'í† ë§ˆí† , ê³ ì¶”, ì†Œê³ ê¸°, ìëª½', c:'#a64e4e', k:'ì†Œê³ ê¸°êµ¬ì´ íŒŒìŠ¤íƒ€ ë§›ì§‘', s:{w:'ç‡ˆç«å¯è¦ª', m:'ë”°ëœ»í•œ ë“±ë¶ˆì„ ê°€ê¹Œì´í•˜ë“¯ ì—´ì •ì´ í•„ìš”í•œ ë•Œ'}},
        'í† ':{t:'åœŸ: í™©ìƒ‰ì˜ ì¤‘ì‹¬', f:'ë‹¨í˜¸ë°•, ê³ êµ¬ë§ˆ, ê°ì, ë‘ë¶€', c:'#c4a46d', k:'í•œì •ì‹ ì²­êµ­ì¥ ë§›ì§‘', s:{w:'åšå¾·è¼‰ç‰©', m:'ë•…ì²˜ëŸ¼ ë‘í„°ìš´ ë•ìœ¼ë¡œ ì•ˆì •ì´ í•„ìš”í•œ ë•Œ'}},
        'ê¸ˆ':{t:'é‡‘: ë°±ìƒ‰ì˜ ê²°ì‹¤', f:'ë„ë¼ì§€, ë¬´, ì–‘íŒŒ, ìƒì„ íšŒ', c:'#8a8a8a', k:'ì¼ì‹ ì¡°ê°œêµ¬ì´ ì„¤ë íƒ•', s:{w:'åˆ‡ç£‹ç¢ç£¨', m:'ìì‹ ì„ ë‹¨ë‹¨í•˜ê³  ì˜ˆë¦¬í•˜ê²Œ ê°€ë‹¤ë“¬ì„ ë•Œ'}},
        'ìˆ˜':{t:'æ°´: ê²€ì€ ì§€í˜œ', f:'ê²€ì€ì½©, ë¯¸ì—­, ë¼ì§€ê³ ê¸°, í¬ë„', c:'#4e657a', k:'í‘ë¼ì§€ ë¯¸ì—­êµ­ í•´ì‚°ë¬¼', s:{w:'ä¸Šå–„è‹¥æ°´', m:'ë¬¼ê³¼ ê°™ì´ ìœ ì—°í•˜ê³  ê¹Šì€ ì§€í˜œê°€ í•„ìš”í•œ ë•Œ'}}
    };

    function analyze(){
        const b=document.getElementById('birthDate').value; if(!b) return;
        const solar=Solar.fromYmdHms(new Date(b).getFullYear(), new Date(b).getMonth()+1, new Date(b).getDate(), document.getElementById('birthTime').value,0,0);
        const tLunar=Solar.fromDate(new Date()).getLunar();
        const map={'ç”²':'ëª©','ä¹™':'ëª©','å¯…':'ëª©','å¯':'ëª©','ä¸™':'í™”','ä¸':'í™”','å·³':'í™”','åˆ':'í™”','æˆŠ':'í† ','å·±':'í† ','è¾°':'í† ','æˆŒ':'í† ','ä¸‘':'í† ','æœª':'í† ','åºš':'ê¸ˆ','è¾›':'ê¸ˆ','ç”³':'ê¸ˆ','é…‰':'ê¸ˆ','å£¬':'ìˆ˜','ç™¸':'ìˆ˜','äº¥':'ìˆ˜','å­':'ìˆ˜'};
        baseCounts={'ëª©':0,'í™”':0,'í† ':0,'ê¸ˆ':0,'ìˆ˜':0};
        const my8=solar.getLunar().getEightChar();
        [my8.getYearGan(),my8.getYearZhi(),my8.getMonthGan(),my8.getMonthZhi(),my8.getDayGan(),my8.getDayZhi(),my8.getTimeGan(),my8.getTimeZhi(),tLunar.getDayGan(),tLunar.getDayZhi()].forEach(c=>{if(map[c])baseCounts[map[c]]++;});
        
        const lack=Object.entries(baseCounts).sort((a,b)=>a[1]-b[1])[0][0];
        currentKeyword=data[lack].k;
        document.getElementById('dailyFortune').innerText=`ì˜¤ëŠ˜ì˜ ì¼ì§„: ${tLunar.getDayInGanZhi()}ì¼ | ë¶„ì„ ê¸°ë°˜: ì‚¬ì£¼ 8ì + ì¼ì§„ 2ì`;
        document.getElementById('resTitle').innerText=data[lack].t;
        document.getElementById('resFood').innerHTML=data[lack].f;
        drawChart(baseCounts);
        document.getElementById('resultArea').style.display='block';
    }

    function drawChart(c){
        const ctx=document.getElementById('energyChart').getContext('2d');
        if(chart) chart.destroy();
        chart=new Chart(ctx,{type:'radar',data:{labels:['ëª©','í™”','í† ','ê¸ˆ','ìˆ˜'],datasets:[{data:[c['ëª©'],c['í™”'],c['í† '],c['ê¸ˆ'],c['ìˆ˜']],backgroundColor:'rgba(44,44,44,0.1)',borderColor:'#2c2c2c',borderWidth:1}]},options:{scales:{r:{beginAtZero:true,max:6,ticks:{display:false}}},plugins:{legend:{display:false}}}});
    }

    function addDiary(type){
        diaryCounts[type]++;
        diaryLog.push({t:type, time:new Date().toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'})});
        const final={}; for(let k in baseCounts) final[k]=baseCounts[k]+diaryCounts[k];
        const sorted=Object.entries(final).sort((a,b)=>a[1]-b[1]);
        document.getElementById('balanceAdvice').innerText= (sorted[sorted.length-1][1]-sorted[0][1] <=1) ? "â˜¯ï¸ ì™„ë²½í•œ ì¤‘í™”(ä¸­å’Œ) ìƒíƒœì…ë‹ˆë‹¤!" : `ë¶€ì¡±í•œ '${sorted[0][0]}' ê¸°ìš´ì„ ë” ì±„ì›Œë³´ì„¸ìš”.`;
    }

    function saveJournal(){
        const name=document.getElementById('userNameInput').value||"ê·€í•˜";
        document.getElementById('jDate').innerText=new Date().toLocaleDateString();
        document.getElementById('jUser').innerText=`${name} ë‹˜ì˜ ì‹ê²° ë³´ì „`;
        document.getElementById('jList').innerHTML=diaryLog.map(l=>`<div style="margin-bottom:10px;"><b>${l.t}ê¸°ìš´</b> ì„­ì·¨ (${l.time})</div>`).join('');
        const sorted=Object.entries(baseCounts).map(([k,v])=>[k,v+diaryCounts[k]]).sort((a,b)=>a[1]-b[1]);
        const s = (sorted[sorted.length-1][1]-sorted[0][1]<=1) ? {w:'ä¸­å’Œä¹‹æ°£',m:'ì¡°í™”ë¥¼ ì´ë£¬ ìƒíƒœ'} : data[sorted[0][0]].s;
        document.getElementById('jSWord').innerText=s.word||s.w; document.getElementById('jSMean').innerText=s.mean||s.m;
        const target=document.getElementById('journalCapture'); target.style.display='block';
        html2canvas(target,{scale:2}).then(canvas=>{ const a=document.createElement('a'); a.download='ì‹ê²°_ì¼ê¸°.png'; a.href=canvas.toDataURL(); a.click(); target.style.display='none'; });
    }
</script>
</body>
</html>
